/*! carbon 11-06-2016 */
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.carbon=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=a("./selection"),e=a("./paragraph"),f=a("./section"),g=a("./utils"),h=a("./loader"),i=a("./layout"),j=a("./figure"),k=a("./extensions/embeddedComponent"),l=function(a){var b=g.extend({sections:[],editor:null},a);this.editor=b.editor,this.selection=d.getInstance(),this.dom=document.createElement(l.TAG_NAME),this.dom.className=l.ELEMENT_CLASS_NAME,this.sections=[];for(var c=0;c<b.sections.length;c++)this.insertSection(b.sections[c]);this.history=[],this.historyAt=0,this.isRendered=!1,this.editMode=!1};b.exports=l,l.TAG_NAME="article",l.ELEMENT_CLASS_NAME="carbon",l.fromJSON=function(a){for(var b=[],c=0;c<a.sections.length;c++)b.push(f.fromJSON(a.sections[c]));return new l({sections:b})},l.prototype.insertSection=function(a){return a.components&&a.components.length||a.insertComponentAt(new e,0),this.sections.push(a),this.isRendered&&a.render(this.dom,{editMode:this.editMode}),a},l.prototype.removeSection=function(a){var b=this.sections.indexOf(a);return this.sections.splice(b,1),a},l.prototype.updateSection=function(a){return a},l.prototype.insertComponent=function(a){var b=this.selection.getSectionAtEnd().insertComponent(a);return b},l.prototype.removeComponent=function(a){var b=this.sections.indexOf(a);return this.components.splice(b,1),a},l.prototype.getFirstComponent=function(){return this.sections[0].getFirstComponent()},l.prototype.getLastComponent=function(){return this.sections[this.sections.length-1].getLastComponent()},l.prototype.hasCover=function(){for(var a=[i.Types.Staged,i.Types.Bleed],b=this.getFirstComponent();!b.getLength()&&b.getNextComponent();)b=b.getNextComponent();if(b instanceof i){var c=b.getFirstComponent();return(c instanceof j||c instanceof k)&&-1!==a.indexOf(b.type)}},l.prototype.render=function(a,b){this.editMode=!(!b||!b.editMode),a.appendChild(this.dom),this.editMode||g.addResizeListener(this.dom,this.handleResize_.bind(this)),this.isRendered=!0;for(var c=0;c<this.sections.length;c++)this.sections[c].render(this.dom,{editMode:this.editMode})},l.prototype.getJSONModel=function(){for(var a={sections:[]},b=0;b<this.sections.length;b++)a.sections.push(this.sections[b].getJSONModel());return a},l.prototype.getLength=function(){for(var a=0,b=0;b<this.sections.length;b++)a+=this.sections[b].getLength();return a},l.prototype.getFirstTextComponent=function(){for(var a=this.sections[0].components[0],b=a.getFirstComponent(),c=b;c&&!(c instanceof e);)c=c.getNextComponent();return c?c:void 0},l.prototype.getTitle=function(){var a=this.getFirstTextComponent();return a&&a.isHeader()?a.text:void 0},l.prototype.getSnippet=function(a){var b=this.getFirstTextComponent();b&&b.isHeader()&&(b=b.getNextComponent());for(var c=a||35,d=0,f=[];b;){if(b instanceof e){var g=b.text.replace(/\s/,"");g.length&&(f.push(b.text),d+=b.text.split(/\s/).length)}if(d>=c)break;b=b.getNextComponent()}var h=f.join(" ").split(" ");return h=h.slice(0,c),h&&h.length?h.join(" ")+"...":void 0},l.prototype.transaction=function(a){this.historyAt<this.history.length&&this.history.splice(this.historyAt,this.history.length-this.historyAt),this.history.push(a),this["do"]()},l.prototype["do"]=function(){for(var a=this.history[this.historyAt++],b=0;b<a.length;b++)this.exec(a[b],"do")},l.prototype.redo=function(){this.historyAt<this.history.length&&this["do"]()},l.prototype.undo=function(){if(this.historyAt>0)for(var a=this.history[--this.historyAt],b=a.length-1;b>=0;b--)this.exec(a[b],"undo")},l.prototype.exec=function(a,b){var c,d,e,f,i,j=this.selection,k=a[b].op;if("insertChars"===k)d=a[b].component,e=a[b].value,f=a[b].index,c=g.getReference(d),c.insertCharactersAt(e,f),a[b].cursorOffset&&j.setCursor({component:c,offset:a[b].cursorOffset});else if("removeChars"===k)d=a[b].component,f=a[b].index,i=a[b].count,c=g.getReference(d),c.removeCharactersAt(f,i),a[b].cursorOffset&&j.setCursor({component:c,offset:a[b].cursorOffset});else if("updateComponent"===k)d=a[b].component,e=a[b].value,c=g.getReference(d),void 0!==e&&c.setText(e),a[b].formats&&c.applyFormats(a[b].formats),a[b].attrs&&c.updateAttributes(a[b].attrs),void 0!==a[b].cursorOffset&&(a[b].selectRange?j.select({component:c,offset:a[b].cursorOffset},{component:c,offset:a[b].cursorOffset+a[b].selectRange}):j.setCursor({component:c,offset:a[b].cursorOffset}));else if("deleteComponent"===k){if(c=g.getReference(a[b].component),c.section.removeComponent(c),a[b].cursor){var l=g.getReference(a[b].cursor.component);l.select(a[b].cursor.offset)}}else if("insertComponent"===k){var m=g.getReference(a[b].section),n=g.extend({name:a[b].component},a[b].attrs||{}),o=a[b].componentClass,p=h.load(o);c=new p(n),c.section=m,m.insertComponentAt(c,a[b].index)}},l.prototype.handleResize_=function(){for(var a=0;a<this.sections.length;a++)this.sections[a].rerender()},l.prototype.trimDirection_=function m(a,b){var c;a instanceof e&&a.isBlank()&&(c=b?a.getPreviousComponent():a.getNextComponent(),a.section.removeComponent(a),c&&m(c,b))},l.prototype.trim=function(){var a=this.getFirstComponent(),b=this.getLastComponent(),c=a.getFirstComponent(),d=b.getLastComponent();this.trimDirection_(c),c!==d&&this.trimDirection_(d,!0)}},{"./extensions/embeddedComponent":9,"./figure":19,"./layout":23,"./loader":25,"./paragraph":27,"./section":28,"./selection":29,"./utils":33}],2:[function(a,b,c){"use strict";var d=a("./utils"),e=a("./errors"),f=a("./loader"),g=a("./selection"),h=function(a){var b=d.extend({editor:null,section:null,name:d.getUID(),inline:!1,parentComponent:null},a);this.editor=b.editor,this.inline=b.inline,this.parentComponent=b.parentComponent,this.name=b.name,this.section=b.section,this.dom=null,this.isRendered=!1,this.editMode=!1,this.selectionDom=null};b.exports=h,h.CLASS_NAME="Component",f.register(h.CLASS_NAME,h),h.onInstall=function(a){},h.prototype.getNextComponent=function(){if(this.parentComponent&&this.inline)return this.parentComponent.getNextComponent();if(this.section){var a=this.section.components.indexOf(this),b=this.section.components[a+1];return!b&&(b=this.section.getNextComponent(),b&&b.components)?b.getFirstComponent():b}},h.prototype.getPreviousComponent=function(){if(this.section){var a=this.section.components.indexOf(this),b=this.section.components[a-1];return!b&&(b=this.section.getPreviousComponent(),b&&b.components)?b.getLastComponent():b}},h.prototype.getJSONModel=function(){var a={component:h.CLASS_NAME,name:this.name};return this.formats&&(a.formats=this.formats),a},h.prototype.getIndexInSection=function(){return this.section?this.section.components.indexOf(this):this.parentComponent?this.parentComponent.components?this.parentComponent.components.indexOf(this):0:null},h.prototype.render=function(a,b){this.editMode=!(!b||!b.editMode),!this.isRendered&&this.dom&&(this.dom.setAttribute("carbon","1"),d.setReference(this.name,this),this.isRendered=!0,b&&b.insertBefore?a.insertBefore(this.dom,b.insertBefore):a.appendChild(this.dom))},h.prototype.getDeleteOps=function(a){throw e.NotImplementedError("Component Must Implement getDeleteOps")},h.prototype.getInsertOps=function(a){throw e.NotImplementedError("Component Must Implement getDeleteOps")},h.prototype.getInsertCharsOps=function(a,b){throw e.NotImplementedError("Component Must Implement getInsertCharsOps")},h.prototype.getRemoveCharsOps=function(a,b,c){throw e.NotImplementedError("Component Must Implement getRemoveCharsOps")},h.prototype.getUpdateOps=function(a,b,c){throw e.NotImplementedError("Component does not Implement getUpdateOps")},h.prototype.select=function(a){this.selectionDom&&this.selectionDom.focus();var b=g.getInstance();b.setCursor({component:this,offset:a})},h.prototype.getLength=function(){return 1},h.prototype.getDomLength=function(){return this.getLength()},h.prototype.shouldRerender=function(){return!1},h.prototype.rerender=function(){}},{"./errors":4,"./loader":25,"./selection":29,"./utils":33}],3:[function(a,b,c){"use strict";var d=a("./article"),e=a("./selection"),f=a("./paragraph"),g=a("./list"),h=a("./figure"),i=a("./section"),j=a("./utils"),k=a("./extensions/formattingExtension"),l=a("./extensions/shortcutsManager"),m=a("./extensions/componentFactory"),n=a("./toolbars/toolbar"),o=a("./extensions/toolbeltExtension"),p=a("./extensions/uploadExtension"),q=a("./i18n"),r=a("./layout"),s=function(a,b){var c=j.extend({modules:[],rtl:!1,locale:"en",article:new d({sections:[new i({components:[new r({components:[new f({placeholder:"Editor"})]})]})]})},b);q.setCurrentLocale(c.locale),this.componentFactory=new m,this.name=j.getUID(),this.rtl=c.rtl,this.element=a,this.article=c.article,this.article.editor=this,this.shortcutsManager=new l(this),this.toolbars={},this.selection=e.getInstance(),this.disableInputHandler=!1;var t=new n({name:s.INLINE_TOOLBAR_NAME,classNames:[s.INLINE_TOOLBAR_CLASS_NAME],rtl:this.rtl});this.registerToolbar(s.INLINE_TOOLBAR_NAME,t);var u=new n({name:s.BLOCK_TOOLBAR_NAME,classNames:[s.BLOCK_TOOLBAR_CLASS_NAME],rtl:this.rtl});this.registerToolbar(s.BLOCK_TOOLBAR_NAME,u),this.installedModules={},this.install(i),this.install(f),this.install(g),this.install(h),this.install(k),this.install(o),this.install(p);for(var v=0;v<c.modules.length;v++)this.install(c.modules[v]);this.composition_={component:null,start:null,update:null,end:null},this.init(),this.setArticle(this.article)};s.prototype=new j.CustomEventTarget,b.exports=s,s.INLINE_TOOLBAR_CLASS_NAME="editor-inline-toolbar",s.BLOCK_TOOLBAR_CLASS_NAME="editor-block-toolbar",s.BLOCK_TOOLBAR_NAME="block-toolbar",s.INLINE_TOOLBAR_NAME="inline-toolbar",s.ATTACHMENT_ADDED_EVENT_NAME="attachment-added",s.prototype.loadJSON=function(a){var b=d.fromJSON(a);this.setArticle(b)},s.prototype.init=function(){this.selection.initSelectionListener(this.element),this.element.addEventListener("keydown",this.handleKeyDownEvent.bind(this)),this.element.addEventListener("keyup",this.handleKeyUpEvent.bind(this)),this.element.addEventListener("input",j.debounce(this.handleInputEvent.bind(this),200).bind(this)),this.element.addEventListener("cut",this.handleCut.bind(this)),this.element.addEventListener("paste",this.handlePaste.bind(this)),this.element.classList.add("carbon-editor"),this.element.setAttribute("contenteditable",!0),this.selection.addEventListener(e.Events.SELECTON_CHANGED,this.handleSelectionChanged.bind(this))},s.prototype.destroy=function(){var a;for(a in this.toolbars)this.toolbars[a].onDestroy&&this.toolbars[a].onDestroy();for(a in this.installedModules)this.installedModules[a].onDestroy&&this.installedModules[a].onDestroy();this.componentFactory.onDestroy(),this.shortcutsManager.onDestroy(),this.selection.clearEventListeners()},s.prototype.setArticle=function(a){a.editor=this,this.article=a},s.prototype.render=function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.article.render(this.element,{editMode:!0}),this.selection.setCursor({component:this.article.sections[0].getFirstComponent().getFirstComponent(),offset:0}),this.dispatchEvent(new Event("change"))},s.prototype.install=function(a,b,c){this.installedModules[a.CLASS_NAME]&&!c&&console.warn(a.CLASS_NAME+" module has already been installed in this editor."),this.installedModules[a.CLASS_NAME]=a,a.onInstall(this,b)},s.prototype.registerShrotcut=function(a,b,c){this.shortcutsManager.register(a,b,c)},s.prototype.isEmpty=function(){return 0===this.article.getLength()},s.prototype.getTitle=function(){return this.article.getTitle()},s.prototype.getSnippet=function(a){return this.article.getSnippet(a)},s.prototype.registerToolbar=function(a,b){this.toolbars[a]=b},s.prototype.getToolbar=function(a){return this.toolbars[a]},s.prototype.getModule=function(a){return this.installedModules[a]},s.prototype.registerRegex=function(a,b,c){this.componentFactory.registerRegex(a,b,c)},s.prototype.handleSelectionChanged=function(a){this.dispatchEvent(a)},s.prototype.handleInputEvent=function(){if(this.disableInputHandler!==!0){var a,b=this.selection.start.offset,c=this.selection.start.component,d=c.text,e=c.getLength();if(c instanceof f){var g=j.getTextFromElement(c.dom),h=g.length,i=h-e,k=[];0>i?(a=d.substring(b,b-i),j.arrays.extend(k,c.getRemoveCharsOps(a,b))):i>0&&(a=g.substring(b-i,b),j.arrays.extend(k,c.getInsertCharsOps(a,Math.max(b-i,0)))),this.article.transaction(k),this.dispatchEvent(new Event("change"))}}},s.prototype.handlePendingInputIfAny_=function(){this.disableInputHandler=!1,this.handleInputEvent()},s.prototype.handleKeyUpEvent=function(){this.disableInputHandler=!1},s.prototype.handleKeyDownEvent=function(a){this.disableInputHandler=!0;var b,c,d,e="insert-chars",g="remove-chars",h=this.article.selection,i=this.article,k=!1,l=[],m=[],n=this,o=null,p=37,q=39,s=this.rtl?p:q,t=this.rtl?q:p;if(13===a.keyCode&&this.handlePendingInputIfAny_(),8===a.keyCode||46===a.keyCode?(this.currentOperation_===e&&this.handlePendingInputIfAny_(),this.currentOperation_=g):(this.currentOperation_===g&&this.handlePendingInputIfAny_(),this.currentOperation_=e),j.isUndo(a))this.article.undo(),h.updateSelectionFromWindow(),k=!0;else if(j.isRedo(a))this.article.redo(),h.updateSelectionFromWindow(),k=!0;else if(j.isSelectAll(a)){var u=i.getFirstComponent(),v=i.getLastComponent();h.select({component:u.getFirstComponent(),offset:0},{component:v.getLastComponent(),offset:v.getLastComponent().getLength()}),k=!0}else if(h.isRange()&&j.willTypeCharacter(a)){var w=h.getSectionAtStart();w&&(m=w.getComponentsBetween(h.getComponentAtStart(),h.getComponentAtEnd())),j.arrays.extend(l,this.getDeleteSelectionOps()),this.article.transaction(l),h.setCursor(h.start),l=[];var x=[13,8,46];k=-1!==x.indexOf(a.keyCode)}var y,z=h.getComponentAtEnd(),A=z.getIndexInSection(),B=z.getNextComponent(),C=z.getPreviousComponent(),D=z instanceof f,E=B instanceof f,F=C instanceof f;switch(a.keyCode){case 13:if(h.isCursorAtEnding()||!D||z.inline){var G;if(D&&(G=this.componentFactory.match(z.text)),G)G(z,function(a){i.transaction(a),setTimeout(function(){n.dispatchEvent(new Event("change"))},10)});else if(E&&(B.isPlaceholder()||z.inline))h.setCursor({component:B,offset:0});else{var H=z.paragraphType,I=h.getSectionAtEnd(),J=A-m.length+1;if(o={component:z.name,offset:h.end.offset},H===f.Types.ListItem){if(0===z.getLength()){var K=I;H=f.Types.Paragraph,I=h.getSectionAtEnd().section,J<K.getLength()&&j.arrays.extend(l,K.getSplitOps(J)),j.arrays.extend(l,z.getDeleteOps(J,o)),J=h.getSectionAtEnd().getIndexInSection()+1}}else z.parentComponent&&z.inline?(I=z.parentComponent.section,J=z.parentComponent.getIndexInSection()+1,H=f.Types.Paragraph):H=f.Types.Paragraph;z.section instanceof r&&z.section.type!==r.Types.SingleColumn&&(I=z.section.getNextComponent(),J=0,I&&I.type===r.Types.SingleColumn||(I=new r({type:r.Types.SingleColumn,section:z.section.section,components:[]}),j.arrays.extend(l,I.getInsertOps(z.section.getIndexInSection()+1)))),b=new f({section:I,paragraphType:H}),j.arrays.extend(l,b.getInsertOps(J,o))}}else j.arrays.extend(l,this.getSplitParagraphOps(-m.length));this.article.transaction(l),k=!0;break;case 8:D&&z.getLength()?h.isCursorAtBeginning()&&C?(this.handlePendingInputIfAny_(),y=0,F&&(y=C.text.length,j.arrays.extend(l,this.getMergeParagraphsOps(C,z,-m.length)),this.article.transaction(l)),h.setCursor({component:C,offset:y}),k=!0):h.isCursorAtBeginning()&&!C&&(this.handlePendingInputIfAny_(),k=!0):(this.handlePendingInputIfAny_(),o=null,C?(o={offset:0},F&&(o.offset=C.getLength()),o.component=C.name):B&&(o={offset:0,component:B.name}),j.arrays.extend(l,z.getDeleteOps(-m.length,o)),C||B||(b=new f({section:h.getSectionAtEnd()}),j.arrays.extend(l,b.getInsertOps(A-m.length,o))),this.article.transaction(l),k=!0);break;case 46:D?h.isCursorAtEnding()&&B&&(this.handlePendingInputIfAny_(),E?(y=z.text.length,j.arrays.extend(l,this.getMergeParagraphsOps(z,B,-m.length)),this.article.transaction(l),h.setCursor({component:z,offset:y})):(this.handlePendingInputIfAny_(),h.setCursor({component:B,offset:0})),k=!0):(this.handlePendingInputIfAny_(),o=null,C?o={component:C.name,offset:C.getLength()}:B&&(o={component:B.name,offset:0}),j.arrays.extend(l,z.getDeleteOps(-m.length,o)),B||C||(b=new f({section:h.getSectionAtEnd()}),j.arrays.extend(l,b.getInsertOps(A-m.length,o))),this.article.transaction(l),k=!0);break;case t:C&&!D&&(c=0,F&&(c=C.getLength()),h.setCursor({component:C,offset:c}),k=!0);break;case 38:C&&(c=0,F&&!D&&(D?(d=h.start.offset,c=Math.min(C.getLength(),d)):c=C.getLength(),h.setCursor({component:C,offset:c}),k=!0));break;case s:h.isCursorAtEnding()&&B&&(h.setCursor({component:B,offset:0}),k=!0);break;case 40:B&&(E&&!D&&(d=h.end.offset),c=Math.min(B.getLength(),d),h.setCursor({component:B,offset:c}),k=!0)}229===a.keyCode||k&&(a.preventDefault(),a.stopPropagation());var L=this.dispatchEvent.bind(this);setTimeout(function(){L(new Event("change"))},10)},s.prototype.getDeleteSelectionOps=function(){var a,b=[],c=this.article.selection,d=c.getSectionAtStart(),e=[];d&&(e=d.getComponentsBetween(c.getComponentAtStart(),c.getComponentAtEnd()));for(var g=0;g<e.length;g++)j.arrays.extend(b,e[g].getDeleteOps(-g));if(c.getComponentAtEnd()!==c.getComponentAtStart()){var h=c.getComponentAtEnd();if((h instanceof f||c.end.offset>0)&&j.arrays.extend(b,h.getDeleteOps(-e.length)),h instanceof f){var i=h.text,k=i.substring(c.end.offset,i.length),l=c.getComponentAtStart().text,m=l.substring(c.start.offset,l.length),n=c.getComponentAtStart(),o=n.getFormatsForRange(c.start.offset,l.length),p=l.length-c.start.offset;(o&&o.length||p)&&j.arrays.extend(b,n.getUpdateOps({formats:o},c.start.offset,p)),m&&m.length&&j.arrays.extend(b,n.getRemoveCharsOps(m,c.start.offset));var q=i.length-k.length;j.arrays.extend(b,n.getInsertCharsOps(k,c.start.offset));for(var r=h.getFormatsForRange(c.end.offset,i.length),s=-q+c.start.offset,t=0;t<r.length;t++)r[t].from+=s,r[t].to+=s;j.arrays.extend(b,n.getUpdateOps({formats:r},l.length-m.length))}}else{var u=c.getComponentAtStart(),v=u.text.substring(c.start.offset,c.end.offset);a=c.end.offset-c.start.offset;var w=u.getFormatsForRange(c.start.offset,c.end.offset);j.arrays.extend(b,u.getUpdateOps({formats:w},c.start.offset,a)),j.arrays.extend(b,u.getRemoveCharsOps(v,c.start.offset))}return b},s.prototype.getSplitParagraphOps=function(a){var b=[],c=this.article.selection,d=c.getComponentAtEnd(),e=d.getIndexInSection(),g=d.text.substring(c.end.offset,d.text.length),h=d.getFormatsForRange(c.start.offset,d.text.length);j.arrays.extend(b,d.getUpdateOps({formats:h},c.start.offset)),j.arrays.extend(b,d.getRemoveCharsOps(g,c.start.offset));for(var i=j.clone(h),k=-c.start.offset,l=0;l<i.length;l++)i[l].from+=k,i[l].to+=k;var m=new f({section:c.getSectionAtEnd(),text:g,formats:i,paragraphType:d.paragraphType});return j.arrays.extend(b,m.getInsertOps(e+a+1)),b},s.prototype.getMergeParagraphsOps=function(a,b,c){var d=[],e=a.text.length;j.arrays.extend(d,b.getDeleteOps(-c)),j.arrays.extend(d,a.getInsertCharsOps(b.text,e));for(var f=j.clone(b.formats),g=a.text.length,h=0;h<f.length;h++)f[h].from+=g,f[h].to+=g;return j.arrays.extend(d,a.getUpdateOps({formats:f},e)),d},s.prototype.handlePaste=function(a){this.handlePendingInputIfAny_();var b,c=this.selection.getComponentAtEnd();if(window.clipboardData&&window.clipboardData.getData)b=window.clipboardData.getData("Text");else if(a.clipboardData&&a.clipboardData.getData){var d=a.clipboardData;c.inline?(b=d.getData("text/plain"),b=b.split("\n").join(" ")):b=d.getData("text/html")||d.getData("text/plain")}var e=document.createElement("div");e.innerHTML=b,c.getPreviousComponent()&&(c=c.getPreviousComponent());var g=this.getDeleteSelectionOps();this.article.transaction(g);var h=this.processPastedContent(e);this.article.transaction(h);var i,j=this,k=this.selection.getComponentAtEnd();k.getNextComponent()&&(k=k.getNextComponent());for(var l=c,m=function(a){j.article.transaction(a),setTimeout(function(){j.dispatchEvent(new Event("change"))},2)};l&&l!==k;){var n=l instanceof f;n&&(i=this.componentFactory.match(l.text),i&&i(l,m)),l=l.getNextComponent()}this.selection.updateSelectionFromWindow(),a.preventDefault()},s.prototype.getJSONModel=function(){return this.article.getJSONModel()},s.prototype.getHTML=function(){return this.article.dom.outerHTML},s.prototype.processPastedContent=function(a,b){function c(a){for(var b=a.childNodes,e=0;e<b.length;e++){if(-1===x.indexOf(b[e].nodeName))return!1;if(b[e].childNodes)for(var f=b[e].childNodes,g=0;g<f.length;g++)if(!d(f)||!c(f[g]))return!1}return!0}function d(a){for(var b=0,c=0;c<a.length;c++)if(a[c]&&"meta"===a[c].nodeName.toLowerCase())b++;else if(-1===x.indexOf(a[c].nodeName))return!1;return a.length-b<2?!0:void 0}var e,i,l,m,n,o=[],p=j.getTextFromElement(a),q=a.childNodes,r=this.article.selection,s=r.getComponentAtStart(),t=r.getSectionAtStart(),u=s.getIndexInSection(),v=b||u,w={component:s.name,offset:r.end.offset},x=["B","BR","BIG","I","SMALL","ABBR","ACRONYM","CITE","EM","STRONG","A","BDO","STRIKE","S","SPAN","SUB","SUP","#text","META"];if(!q||!q.length||d(q)&&c(a)){var y=p.split("\n");if(y.length<2){var z=s.text.substring(0,r.start.offset),A=z.length;j.arrays.extend(o,s.getInsertCharsOps(p,A))}else for(var B=0;B<y.length;B++)y[B].trim().length>0&&(m=new f({section:t,text:y[B]}),j.arrays.extend(o,m.getInsertOps(v++,w)))}else if(c(a))e=j.getTextFromElement(a),m=new f({section:t,text:e,formats:k.generateFormatsForNode(a)}),j.arrays.extend(o,m.getInsertOps(v++,w));else{r.isCursorAtEnding()||(j.arrays.extend(o,this.getSplitParagraphOps(0)),v++);for(var C=0;C<q.length;C++){var D=q[C],E=D.nodeName&&D.nodeName.toLowerCase();switch(E){case void 0:case"meta":case"script":case"style":case"embed":case"br":case"hr":continue;case"figure":var F=D.getElementsByTagName("img");if(!F||!F.length)continue;for(var G=0;G<F.length;G++)n=new h({src:F[G].getAttribute("src")}),n.section=r.getSectionAtEnd(),j.arrays.extend(o,n.getInsertOps(v++),w);i=null;break;case"img":n=new h({src:D.getAttribute("src")}),n.section=r.getSectionAtEnd(),j.arrays.extend(o,n.getInsertOps(v++,w)),i=null;break;case"ul":case"ol":var H=g.UNORDERED_LIST_TAG;"ol"===E&&(H=g.ORDERED_LIST_TAG);var I=D.getElementsByTagName("li");if(!I||!I.length)continue;for(n=new g({tagName:H,components:[]}),n.section=r.getSectionAtEnd(),j.arrays.extend(o,n.getInsertOps(v++,w)),G=0;G<I.length;G++)m=new f({paragraphType:f.Types.ListItem,text:j.getTextFromElement(I[G])}),m.section=n,j.arrays.extend(o,m.getInsertOps(G,w));i=null;break;case"p":case"#text":i=f.Types.Paragraph;break;case"blockquote":i=f.Types.Quote;break;case"h1":i=f.Types.MainHeader;break;case"h2":i=f.Types.SecondaryHeader;break;case"h3":case"h4":case"h5":case"h6":i=f.Types.ThirdHeader;break;case"pre":i=f.Types.Code;break;default:c(q[C])?i=f.Types.Paragraph:(l=this.processPastedContent(q[C],v),v+=l.length)}l?(j.arrays.extend(o,l),l=null):i&&(e=j.getTextFromElement(D),m=new f({section:t,text:e,paragraphType:i,formats:k.generateFormatsForNode(D)}),j.arrays.extend(o,m.getInsertOps(v++,w)))}}return o},s.prototype.handleCut=function(){this.handlePendingInputIfAny_(),this.disableInputHandler=!0;var a=this.getDeleteSelectionOps(),b=this.article,c=this.dispatchEvent.bind(this);setTimeout(function(){b.transaction(a),this.disableInputHandler=!1,c(new Event("change"))},20)}},{"./article":1,"./extensions/componentFactory":8,"./extensions/formattingExtension":12,"./extensions/shortcutsManager":16,"./extensions/toolbeltExtension":17,"./extensions/uploadExtension":18,"./figure":19,"./i18n":20,"./layout":23,"./list":24,"./paragraph":27,"./section":28,"./selection":29,"./toolbars/toolbar":32,"./utils":33}],4:[function(a,b,c){"use strict";var d={};b.exports=d,d.NotImplementedError=function(a){this.name="NotImplementedError",this.message=a||""},d.NotImplementedError.prototype=Error.prototype,d.AlreadyRegisteredError=function(a){this.name="AlreadyRegisteredError",this.message=a||""},d.AlreadyRegisteredError.prototype=Error.prototype,d.ConfigrationError=function(a){this.name="ConfigrationError",this.message=a||""},d.ConfigrationError.prototype=Error.prototype},{}],5:[function(a,b,c){"use strict";var d=a("../errors"),e=function(){};b.exports=e,e.prototype.getEmbedForUrl=function(a,b,c){throw d.NotImplementedError("AbstractEmbedProvider need to implement getEmbedForUrl")},e.prototype.getUrlsRegex=function(){throw d.NotImplementedError("AbstractEmbedProvider need to implement getUrlsRegexStr")}},{"../errors":4}],6:[function(a,b,c){"use strict";var d=a("../utils"),e=a("../selection"),f=function(a){var b=d.extend({file:null,dataUri:null,figure:null,insertedOps:null},a);this.file=b.file,this.dataUri=b.dataUri,this.figure=b.figure,this.insertedOps=b.insertedOps};b.exports=f,f.prototype.setUploadProgress=function(a){this.progress=a},f.prototype.setAttributes=function(a){for(var b=0;b<this.insertedOps.length;b++){var c=d.extend(this.insertedOps[b]["do"].attrs||{},a);this.insertedOps[b]["do"].attrs=c}this.figure.updateAttributes(a);var f=e.getInstance(),g=f.getComponentAtStart();g===this.figure&&this.figure.select()}},{"../selection":29,"../utils":33}],7:[function(a,b,c){"use strict";var d=a("./abstractEmbedProvider"),e=a("../utils"),f=function(a){var b=e.extend({servicesConfig:{facebookNotes:!0,twitter:!0,instagram:!0,github:!1,soundcloud:!1,youtube:!1,vimeo:!1,vine:!1,slideshare:!1,facebookPosts:!0,facebookVideos:!1}},a);d.call(this,b),this.servicesConfig=b.servicesConfig};f.prototype=Object.create(d.prototype),b.exports=f,f.PROVIDERS_OEMBED_REGEX_MAP={facebookVideos:{"^(https?://(?:www.)facebook.com/(?:video.php?v=\\d+|.*?/videos/\\d+))$":"https://apps.facebook.com/plugins/video/oembed.json/"},facebookPosts:{"^(https?://www.facebook.com/(?:photo.php?.+|photos/\\d+|[a-zA-Z0-9-.]+/(posts|photos|activity)/.+|permalink.php?story_fbid=\\d+|media/set?set=\\d+|questions/\\d+))":"https://apps.facebook.com/plugins/post/oembed.json/"},facebookNotes:{"^(https?://www.facebook.com/notes/[a-zA-Z0-9-.]+/[a-zA-Z0-9-.]+/\\d+)":"https://apps.facebook.com/plugins/post/oembed.json/"},soundcloud:{"^https?://soundcloud.com/.*/.*$":"https://soundcloud.com/oembed?format=js"},youtube:{'^(?:https?://(?:www.)?youtube.com/(?:[^/]+/.+/|(?:v|e(?:mbed)?)/|.*[?&]v=)|youtu.be/)([^"&?/ ]{11})$':"https://www.youtube.com/oembed?format=json"},vimeo:{"^http(?:s?)://(?:www.)?vimeo.com/(([0-9]+)|channels/.+/.+|groups/.+/videos/.+)":"https://vimeo.com/api/oembed.json"},vine:{"^http(?:s?)://(?:www.)?vine.co/v/([a-zA-Z0-9]{1,13})$":"https://vine.co/oembed.json"},twitter:{"^https?://(?:www.)?twitter.com/[a-zA-Z0-9_]+/status/\\d+$":"https://api.twitter.com/1/statuses/oembed.json"},instagram:{"^https?://(?:www.)?instagr.?am(?:.com)?/p/[a-zA-Z0-9_-]+/?":"https://www.instagram.com/publicapi/oembed/"},slideshare:{"^https?://(?:www.)?slideshare.net/[a-zA-Z0-9_-]+/[a-zA-Z0-9_-]+":"https://www.slideshare.net/api/oembed/2?format=jsonp"},github:{"^https?://gist.github.com/.*":"https://noembed.com/embed?format=json"}},f.prototype.getOEmbedEndpointForUrl=function(a,b){var c=e.extend({url:a},b),d=[];for(var f in c)d.push([f,c[f]].join("="));var g=this.getOEmbedBaseForUrl_(a);if(!g)return void console.error("Could not find oembed endpoint for url: ",a);var h=-1===g.indexOf("?")?"?":"&";return[g,d.join("&")].join(h)},f.prototype.getUrlsRegex=function(){var a=f.PROVIDERS_OEMBED_REGEX_MAP,b=[];for(var c in a)if(this.servicesConfig[c])for(var d in a[c])b.push(d);return b.join("|")},f.prototype.getEmbedForUrl=function(a,b,c){function d(a,b){var c="jsonp_callback_"+Math.round(1e5*Math.random());window[c]=function(a){delete window[c],document.body.removeChild(d),b(a)};var d=document.createElement("script");d.src=a+(a.indexOf("?")>=0?"&":"?")+"callback="+c,document.body.appendChild(d)}var e=this.getOEmbedEndpointForUrl(a,c);d(e,b)},f.prototype.getOEmbedBaseForUrl_=function(a){var b=f.PROVIDERS_OEMBED_REGEX_MAP;for(var c in b)if(this.servicesConfig[c])for(var d in b[c]){var e=new RegExp(d,"i"),g=e.exec(a);if(g)return b[c][d]}return null}},{"../utils":33,"./abstractEmbedProvider":5}],8:[function(a,b,c){"use strict";var d=a("../errors"),e=function(){this.regexToFactories={}};b.exports=e,e.prototype.registerRegex=function(a,b,c){if(this.regexToFactories[a]&&!c)throw d.AlreadyRegisteredError('This Regex "'+a+'" has already been registered.');this.regexToFactories[a]=b},e.prototype.match=function(a){for(var b in this.regexToFactories){var c=new RegExp(b),d=c.exec(a);if(d)return this.regexToFactories[b]}},e.prototype.onDestroy=function(){this.regexToFactories={}}},{"../errors":4}],9:[function(a,b,c){"use strict";var d=a("../utils"),e=a("../component"),f=a("../paragraph"),g=a("../loader"),h=a("../i18n"),i=function(a){var b=d.extend({url:null,provider:null,caption:null,sizes:{},type:i.Types.Rich,serviceName:null},a);e.call(this,b),this.url=b.url,this.provider=b.provider,this.service=b.service,this.type=b.type||i.Types.Rich,this.sizes=b.sizes||{},this.caption=b.caption,this.captionParagraph=new f({placeholderText:h.get("placeholder.embed"),text:this.caption,paragraphType:f.Types.Caption,parentComponent:this,inline:!0}),this.dom=document.createElement(i.TAG_NAME),this.dom.setAttribute("contenteditable",!1),this.dom.setAttribute("name",this.name),this.dom.className=i.COMPONENT_CLASS_NAME};i.prototype=Object.create(e.prototype),b.exports=i,i.CLASS_NAME="EmbeddedComponent",g.register(i.CLASS_NAME,i),i.TAG_NAME="figure",i.COMPONENT_CLASS_NAME="embedded",i.CONTAINER_TAG_NAME="div",i.CONTAINER_CLASS_NAME="inner-container",i.OVERLAY_TAG_NAME="div",i.EMBED_TAG_NAME="div",i.CAPTION_TAG_NAME="figcaption",i.OVERLAY_CLASS_NAME="embed-overlay",i.RENDER_FOR_SCREEN_SIZES=[300,450,600,900,1200],i.Types={Rich:"rich",Video:"video",Link:"link",Image:"image"},i.IFRAME_URL="https://cdn.carbon.tools/iframe.html",i.DEV_IFRAME_URL="http://iframe.localhost:8000/dist/iframe.html",i.OFFSCREEN_CONTAINER_ID="carbon-off-screen",i.TEMP_RENDER_CONTAINER_CLASSNAME="temp-render",i.EMBED_SIZE_MESSAGE_TYPE="embed-size",i.prototype.getComponentClassName=function(){return i.CLASS_NAME},i.fromJSON=function(a){return new i(a)},i.onInstall=function(){var a=document.getElementById(i.OFFSCREEN_CONTAINER_ID);a||(a=document.createElement("div"),a.id=i.OFFSCREEN_CONTAINER_ID,a.style.width="3000px",document.body.appendChild(a))},i.prototype.getComponentClassName=function(){return i.CLASS_NAME},i.prototype.oEmbedDataLoaded_=function(a){function b(a){return function(){try{a.parentNode.removeChild(a)}catch(b){console.warn(b)}}}if(!a)return void console.warn("Cound not find oembed for URL: ",this.url);if(a.html){var c=window.getComputedStyle(this.dom),d=parseInt(c.width),e=this.getClosestSupportedScreenSize_(d)||d;if(this.renderForScreen_(e,this.embedDom),this.editMode&&this.type===i.Types.Rich)for(var f=document.getElementById(i.OFFSCREEN_CONTAINER_ID),g=i.RENDER_FOR_SCREEN_SIZES,h=0;h<g.length;h++)if(!this.sizes||!this.sizes[g[h]]){var j=document.createElement("div");j.className=i.TEMP_RENDER_CONTAINER_CLASSNAME,j.style.width=g[h]+"px",f.appendChild(j),this.renderForScreen_(g[h],j),setTimeout(b(j),1e4)}}else console.error("Embedding non-rich component is not supported yet.")},i.prototype.renderForScreen_=function(a,b){var c=i.IFRAME_URL;document.location.host.match(/localhost/)&&(c=i.DEV_IFRAME_URL);var e=g.load("embedProviders")[this.provider],f=e.getOEmbedEndpointForUrl(this.url,{width:a}),h=c+"#"+encodeURIComponent(JSON.stringify({
width:a,oEmbedUrl:f,origin:document.location.origin})),j=document.createElement("iframe");j.src=h,j.setAttribute("frameborder",0),j.setAttribute("width","100%"),j.setAttribute("height",a/2+"px"),d.listen(j,i.EMBED_SIZE_MESSAGE_TYPE,function(b){this.sizes[a]={width:parseFloat(b.width),height:parseFloat(b.height)},this.updateSize_(),j.setAttribute("height",b.height)}.bind(this)),b.appendChild(j)},i.prototype.getClosestSupportedScreenSize_=function(a){var b=[];for(var c in this.sizes)b.push(parseInt(c));for(var d=i.RENDER_FOR_SCREEN_SIZES.length;d>0;d--){var e=i.RENDER_FOR_SCREEN_SIZES[d];e&&-1===b.indexOf(e)&&b.push(e)}b.sort(function(a,b){return a-b});for(var f=b.length;f>0;f--)if(b[f]<=a)return b[f];return b[0]},i.prototype.getRatioFor_=function(a){var b=this.getClosestSupportedScreenSize_(a),c=this.sizes[b];return c&&c.height/c.width*100+"%"},i.prototype.shouldRerender=function(){var a=window.getComputedStyle(this.dom),b=parseInt(a.width),c=this.getClosestSupportedScreenSize_(b),d=parseInt(this.containerDom.style.width);return c!==d},i.prototype.rerender=function(){var a=window.getComputedStyle(this.dom),b=parseInt(a.width),c=this.getClosestSupportedScreenSize_(b),d=this.getRatioFor_(b);this.containerDom.style.width=c+"px",this.embedDom.className="embed-container",this.embedDom.style.paddingBottom=d,setTimeout(function(){this.loadEmbed_(this.oEmbedDataLoaded_.bind(this),{width:this.getClosestSupportedScreenSize_(b)})}.bind(this),200)},i.prototype.updateSize_=function(){if(d.isEmpty(this.sizes))this.embedDom.style.paddingBottom="56.25%";else{var a=window.getComputedStyle(this.dom),b=parseInt(a.width);if(this.type===i.Types.Video||this.type===i.Types.Image){this.embedDom.classList.add("ratio-container");var c=this.getRatioFor_(b);this.embedDom.style.paddingBottom=c,this.embedDom.style.width="auto",this.embedDom.style.height="auto"}else if(b){var e=this.getClosestSupportedScreenSize_(b);e&&this.sizes[e]&&(this.embedDom.style.paddingBottom=0,this.embedDom.style.width=this.sizes[e].width+"px",this.embedDom.style.height=this.sizes[e].height+"px")}}},i.prototype.render=function(a,b){if(!this.isRendered){e.prototype.render.call(this,a,b);var c=window.getComputedStyle(this.dom),d=parseInt(c.width);this.containerDom=document.createElement(i.CONTAINER_TAG_NAME),this.containerDom.className=i.CONTAINER_CLASS_NAME,this.url&&(this.embedDom=document.createElement(i.EMBED_TAG_NAME),this.embedDom.classList.add("embed-container"),this.updateSize_(),this.containerDom.appendChild(this.embedDom),this.dom.appendChild(this.containerDom)),this.captionParagraph.render(this.dom,{editMode:this.editMode}),this.loadEmbed_(function(a){this.type=a.type,this.serviceName=a.provider||a.provider_name,this.serviceName&&this.dom.classList.add(this.serviceName),this.url&&this.updateSize_(),this.editMode&&(this.overlayDom=document.createElement(i.OVERLAY_TAG_NAME),this.overlayDom.className=i.OVERLAY_CLASS_NAME,this.containerDom.appendChild(this.overlayDom),this.overlayDom.addEventListener("click",this.select.bind(this)),this.selectionDom=document.createElement("div"),this.selectionDom.innerHTML="&nbsp;",this.selectionDom.className="selection-pointer",this.selectionDom.setAttribute("contenteditable",!0),this.selectionDom.addEventListener("focus",this.select.bind(this)),this.containerDom.appendChild(this.selectionDom),this.captionParagraph.dom.setAttribute("contenteditable",!0),this.sizes||(this.containerDom.style.width=this.getClosestSupportedScreenSize_(d)+"px")),this.oEmbedDataLoaded_(a)}.bind(this),{width:this.getClosestSupportedScreenSize_(d)})}},i.prototype.loadEmbed_=function(a,b){var c=g.load("embedProviders")[this.provider];c.getEmbedForUrl(this.url,a,b)},i.prototype.getJSONModel=function(){var a={component:this.getComponentClassName(),name:this.name,url:this.url,provider:this.provider,sizes:this.sizes,caption:this.captionParagraph.text,type:this.type,serviceName:this.serviceName};return a},i.prototype.select=function(a){return e.prototype.select.call(this,a),!1},i.prototype.getDeleteOps=function(a,b){var c=[{"do":{op:"deleteComponent",component:this.name,cursor:b},undo:{op:"insertComponent",componentClass:this.getComponentClassName(),section:this.section.name,component:this.name,index:this.getIndexInSection()+(a||0),attrs:{url:this.url,provider:this.provider,caption:this.caption,sizes:this.sizes,type:this.type,serviceName:this.serviceName}}}];return this.section.getLength()<2&&d.arrays.extend(c,this.section.getDeleteOps()),c},i.prototype.getInsertOps=function(a,b){return[{"do":{op:"insertComponent",componentClass:this.getComponentClassName(),section:this.section.name,cursorOffset:0,component:this.name,index:a,attrs:{url:this.url,provider:this.provider,sizes:this.sizes,caption:this.caption,type:this.type,serviceName:this.serviceName}},undo:{op:"deleteComponent",component:this.name,cursor:b}}]},i.prototype.getLength=function(){return 1}},{"../component":2,"../i18n":20,"../loader":25,"../paragraph":27,"../utils":33}],10:[function(a,b,c){"use strict";var d=a("../utils"),e=a("../errors"),f=a("../loader"),g=a("../toolbars/button"),h=a("../paragraph"),i=a("../i18n"),j=function(a){var b=d.extend({editor:null,embedProviders:null,ComponentClass:null},a);this.editor=b.editor,this.embedProviders=b.embedProviders,this.ComponentClass=b.ComponentClass};b.exports=j,j.CLASS_NAME="EmbeddingExtension",j.TOOLBELT_TOOLBAR_NAME="toolbelt-toolbar",j.onInstall=function(a,b){if(!b.embedProviders||!b.ComponentClass)throw e.ConfigrationError('EmbeddingExtension needs "embedProviders" and "ComponentClass"');var c=new j({embedProviders:b.embedProviders,ComponentClass:b.ComponentClass,editor:a});f.register("embedProviders",b.embedProviders,!0),c.init()},j.prototype.init=function(){var a=this,b=function(b){return function(c,d){a.handleRegexMatch(c,d,b)}};for(var c in this.embedProviders){var d=this.embedProviders[c].getUrlsRegex();this.editor.registerRegex(d,b(c))}this.toolbelt=this.editor.getToolbar(j.TOOLBELT_TOOLBAR_NAME);for(var e=[{label:i.get("button.video"),icon:i.get("button.icon.video"),placeholder:i.get("placeholder.video")},{label:i.get("button.photo"),icon:i.get("button.icon.photo"),placeholder:i.get("placeholder.photo")},{label:i.get("button.post"),icon:i.get("button.icon.post"),placeholder:i.get("placeholder.post")},{label:i.get("button.gif"),icon:i.get("button.icon.gif"),placeholder:i.get("placeholder.gif")},{label:i.get("button.quiz"),icon:i.get("button.icon.quiz"),placeholder:i.get("placeholder.quiz")}],f=0;f<e.length;f++){var h=new g({label:e[f].label,icon:e[f].icon,data:{placeholder:e[f].placeholder}});h.addEventListener("click",this.handleInsertClicked.bind(this)),this.toolbelt.addButton(h)}},j.prototype.handleInsertClicked=function(a){var b=a.detail.target,c=b.data.placeholder,d=new h({placeholderText:c,section:this.editor.selection.getSectionAtStart()}),e=this.editor.selection.getComponentAtStart().getIndexInSection();this.editor.article.transaction(d.getInsertOps(e))},j.prototype.handleRegexMatch=function(a,b,c){var e=a.getIndexInSection(),f=[],g=new this.ComponentClass({url:a.text,provider:c});g.section=a.section,d.arrays.extend(f,a.getDeleteOps(e)),d.arrays.extend(f,g.getInsertOps(e)),b(f)}},{"../errors":4,"../i18n":20,"../loader":25,"../paragraph":27,"../toolbars/button":30,"../utils":33}],11:[function(a,b,c){"use strict";var d=a("./abstractEmbedProvider"),e=a("../utils"),f=function(a){var b=e.extend({endpoint:"https://api.embed.ly/1/oembed",apiKey:null},a);this.endpoint=b.endpoint,this.apiKey=b.apiKey,d.call(this,b)};f.prototype=Object.create(d.prototype),b.exports=f,f.SUPPORTED_URLS_REGEX_STRING="^((https?://(www.flickr.com/photos/.*|flic.kr/.*|.*imgur.com/.*|.*dribbble.com/shots/.*|drbl.in/.*|giphy.com/gifs/.*|gph.is/.*|vid.me/.*|www.slideshare.net/.*/.*|www.slideshare.net/mobile/.*/.*|.*.slideshare.net/.*/.*|slidesha.re/.*|www.kickstarter.com/projects/.*/.*|linkedin.com/in/.*|linkedin.com/pub/.*|.*.linkedin.com/in/.*|.*.linkedin.com/pub/.*|linkedin.com/in/.*|linkedin.com/company/.*|.*.linkedin.com/company/.*|www.sliderocket.com/.*|sliderocket.com/.*|app.sliderocket.com/.*|portal.sliderocket.com/.*|beta-sliderocket.com/.*|maps.google.com/maps?.*|maps.google.com/?.*|maps.google.com/maps/ms?.*|www.google..*/maps/.*|google..*/maps/.*|tumblr.com/.*|.*.tumblr.com/post/.*|pastebin.com/.*|storify.com/.*/.*|prezi.com/.*/.*|www.wikipedia.org/wiki/.*|.*.wikipedia.org/wiki/.*|www.behance.net/gallery/.*|behance.net/gallery/.*|jsfiddle.net/.*|www.gettyimages.com/detail/photo/.*|gty.im/.*|jsbin.com/.*/.*|jsbin.com/.*|codepen.io/.*/pen/.*|codepen.io/.*/pen/.*|quora.com/.*/answer/.*|www.quora.com/.*/answer/.*|www.qzzr.com/quiz/.*|.*amazon..*/gp/product/.*|.*amazon..*/.*/dp/.*|.*amazon..*/dp/.*|.*amazon..*/o/ASIN/.*|.*amazon..*/gp/offer-listing/.*|.*amazon..*/.*/ASIN/.*|.*amazon..*/gp/product/images/.*|.*amazon..*/gp/aw/d/.*|www.amzn.com/.*|amzn.com/.*|fiverr.com/.*/.*|www.fiverr.com/.*/.*|.*youtube.com/watch.*|.*.youtube.com/v/.*|youtu.be/.*|.*.youtube.com/user/.*|.*.youtube.com/.*#.*/.*|m.youtube.com/watch.*|m.youtube.com/index.*|.*.youtube.com/profile.*|.*.youtube.com/view_play_list.*|.*.youtube.com/playlist.*|www.youtube.com/embed/.*|youtube.com/gif.*|www.youtube.com/gif.*|www.youtube.com/attribution_link.*|youtube.com/attribution_link.*|youtube.ca/.*|youtube.jp/.*|youtube.com.br/.*|youtube.co.uk/.*|youtube.nl/.*|youtube.pl/.*|youtube.es/.*|youtube.ie/.*|it.youtube.com/.*|youtube.fr/.*|.*twitch.tv/.*|.*twitch.tv/.*/b/.*|www.ustream.tv/recorded/.*|www.ustream.tv/channel/.*|www.ustream.tv/.*|ustre.am/.*|.*.dailymotion.com/video/.*|.*.dailymotion.com/.*/video/.*|www.livestream.com/.*|new.livestream.com/.*|coub.com/view/.*|coub.com/embed/.*|vine.co/v/.*|www.vine.co/v/.*|www.vimeo.com/groups/.*/videos/.*|www.vimeo.com/.*|vimeo.com/groups/.*/videos/.*|vimeo.com/.*|vimeo.com/m/#/.*|player.vimeo.com/.*|www.ted.com/talks/.*.html.*|www.ted.com/talks/lang/.*/.*.html.*|www.ted.com/index.php/talks/.*.html.*|www.ted.com/index.php/talks/lang/.*/.*.html.*|www.ted.com/talks/|khanacademy.org/.*|www.khanacademy.org/.*|www.facebook.com/video.php.*|www.facebook.com/.*/posts/.*|fb.me/.*|www.facebook.com/.*/videos/.*|fb.com|plus.google.com/.*|www.google.com/profiles/.*|google.com/profiles/.*|soundcloud.com/.*|soundcloud.com/.*/.*|soundcloud.com/.*/sets/.*|soundcloud.com/groups/.*|snd.sc/.*))|(https://(vidd.me/.*|vid.me/.*|maps.google.com/maps?.*|maps.google.com/?.*|maps.google.com/maps/ms?.*|www.google..*/maps/.*|google..*/maps/.*|storify.com/.*/.*|medium.com/.*|medium.com/.*/.*|quora.com/.*/answer/.*|www.quora.com/.*/answer/.*|www.qzzr.com/quiz/.*|.*youtube.com/watch.*|.*.youtube.com/v/.*|youtu.be/.*|.*.youtube.com/playlist.*|www.youtube.com/embed/.*|youtube.com/gif.*|www.youtube.com/gif.*|www.youtube.com/attribution_link.*|youtube.com/attribution_link.*|youtube.ca/.*|youtube.jp/.*|youtube.com.br/.*|youtube.co.uk/.*|youtube.nl/.*|youtube.pl/.*|youtube.es/.*|youtube.ie/.*|it.youtube.com/.*|youtube.fr/.*|coub.com/view/.*|coub.com/embed/.*|vine.co/v/.*|www.vine.co/v/.*|gifs.com/gif/.*|www.gifs.com/gif/.*|gifs.com/.*|www.gifs.com/.*|www.vimeo.com/.*|vimeo.com/.*|player.vimeo.com/.*|khanacademy.org/.*|www.khanacademy.org/.*|www.facebook.com/video.php.*|www.facebook.com/.*/posts/.*|fb.me/.*|www.facebook.com/.*/videos/.*|plus.google.com/.*|soundcloud.com/.*|soundcloud.com/.*/.*|soundcloud.com/.*/sets/.*|soundcloud.com/groups/.*)))",f.prototype.getEmbedForUrl=function(a,b,c){var d=this.getOEmbedEndpointForUrl(a,c),e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==e.readyState){var a=JSON.parse(e.responseText);b(a)}},e.open("GET",d,!0),e.send()},f.prototype.getOEmbedEndpointForUrl=function(a,b){var c=e.extend({key:this.apiKey,url:a},b),d=[];for(var f in c)d.push([f,c[f]].join("="));return[this.endpoint,d.join("&")].join("?")},f.prototype.getUrlsRegex=function(){return f.SUPPORTED_URLS_REGEX_STRING}},{"../utils":33,"./abstractEmbedProvider":5}],12:[function(a,b,c){"use strict";var d=a("../paragraph"),e=a("../selection"),f=a("../utils"),g=a("../toolbars/button"),h=a("../toolbars/textField"),i=a("../i18n"),j=function(a){var b=f.extend({enableInline:!0,enableBlock:!0},a);this.enableInline=b.enableInline,this.enableBlock=b.enableBlock,this.editor=null};b.exports=j,j.CLASS_NAME="Formatting",j.ACTIVE_ACTION_CLASS="active",j.Types={BLOCK:"block",INLINE:"inline"},j.BLOCK_ENABLED_ON=[d.Types.Paragraph,d.Types.MainHeader,d.Types.SecondaryHeader,d.Types.ThirdHeader,d.Types.Quote,d.Types.Code],j.Actions={Block:[{label:"h1",value:d.Types.MainHeader,shortcuts:["alt+cmd+1","alt+ctrl+1"]},{label:"h2",value:d.Types.SecondaryHeader,shortcuts:["alt+cmd+2","alt+ctrl+2"]},{label:"h3",value:d.Types.ThirdHeader,shortcuts:["alt+cmd+3","alt+ctrl+3"]},{label:"â€",value:d.Types.Quote,shortcuts:["alt+cmd+4","alt+ctrl+4"]},{label:"{}",value:d.Types.Code,shortcuts:["alt+cmd+5","alt+ctrl+5"]}],Inline:[{label:"B",value:"strong",tagNames:["strong","b"],shortcuts:["ctrl+b","cmd+b"]},{label:"I",value:"em",tagNames:["em","i"],shortcuts:["ctrl+i","cmd+i"]},{label:"U",value:"u",tagNames:["u"],shortcuts:["ctrl+u","cmd+u"]},{label:"S",value:"s",tagNames:["strike","s"],shortcuts:["ctrl+s","cmd+s"]},{label:"a",value:"a",attrs:{href:{required:!0,placeholder:"What is the URL?"}},tagNames:["a"],shortcuts:["ctrl+k","cmd+k"]}]},j.BLOCK_TOOLBAR_NAME="block-toolbar",j.INLINE_TOOLBAR_NAME="inline-toolbar",j.onInstall=function(a){var b=j.getActionForTagName("a");b.attrs.href.placeholder=i.get("placeholder.href");var c=new j;c.init(a)},j.onDestroy=function(){},j.prototype.init=function(a){this.editor=a,this.blockToolbar=a.getToolbar(j.BLOCK_TOOLBAR_NAME),this.inlineToolbar=a.getToolbar(j.INLINE_TOOLBAR_NAME),this.initInlineToolbarButtons(),this.initBlockToolbarButtons(),this.registerFormattingShortcuts_(),this.editor.article.selection.addEventListener(e.Events.SELECTION_CHANGED,this.handleSelectionChangedEvent.bind(this))},j.prototype.initInlineToolbarButtons=function(){for(var a=j.Actions.Inline,b=0;b<a.length;b++){var c=this.createExtraFields(a[b]),d=new g({name:a[b].value,label:a[b].label,data:a[b],fields:c||[]});d.addEventListener("click",this.handleInlineFormatterClicked.bind(this)),this.inlineToolbar.addButton(d)}},j.prototype.initBlockToolbarButtons=function(){for(var a=j.Actions.Block,b=0;b<a.length;b++){var c=new g({name:a[b].value,label:a[b].label,data:a[b]});c.addEventListener("click",this.handleBlockFormatterClicked.bind(this)),this.blockToolbar.addButton(c)}},j.prototype.registerFormattingShortcuts_=function(){for(var a in j.Actions)for(var b=j.Actions[a],c=0;c<b.length;c++)for(var d=b[c],e=0;e<d.shortcuts.length;e++)this.editor.shortcutsManager.register(d.shortcuts[e],this.handleKeyboardShortcut.bind(this))},j.prototype.createExtraFields=function(a){var b=[];if(!a.attrs)return b;for(var c in a.attrs){var d=a.attrs[c],e=new h({placeholder:d.placeholder,required:d.required,name:c});e.addEventListener("keyup",this.handleInlineInputFieldKeyUp.bind(this)),b.push(e)}return b},j.prototype.applyFormatWithAttrs=function(a){for(var b=a.data.value,c={},d=a.fields,e=0;e<d.length;e++)c[d[e].name]=d[e].value;this.handleInlineFormatting(b,c)},j.prototype.handleInlineInputFieldKeyUp=function(a){13===a.keyCode&&this.applyFormatWithAttrs(a.detail.target.parentButton)},j.prototype.didSelectionActuallyChanged_=function(){var a=e.getInstance();return this.lastSelection_&&this.lastSelection_.start.component===a.start.component&&this.lastSelection_.end.component===a.end.component&&this.lastSelection_.start.offset===a.start.offset&&this.lastSelection_.end.offset===a.end.offset?!1:(this.lastSelection_={start:{component:a.start.component,offset:a.start.offset},end:{component:a.end.component,offset:a.end.offset}},!0)},j.prototype.handleSelectionChangedEvent=function(){if(this.didSelectionActuallyChanged_()){var a=window.getSelection(),b=e.getInstance(),c=b.getComponentAtStart(),f=b.getComponentAtEnd();this.blockToolbar.setVisible(!1),this.inlineToolbar.setVisible(!1),a.isCollapsed?(c instanceof d&&-1!==j.BLOCK_ENABLED_ON.indexOf(c.paragraphType)&&(this.blockToolbar.setPositionToStartTopOf(c.dom),this.blockToolbar.setVisible(!0)),this.reloadBlockToolbarStatus()):c instanceof d&&c===f&&setTimeout(function(){var a=window.getSelection();a.isCollapsed||(this.inlineToolbar.setPositionTopOfSelection(),this.inlineToolbar.setVisible(!0),this.reloadInlineToolbarStatus())}.bind(this),150)}},j.prototype.reloadBlockToolbarStatus=function(){var a=this.editor.article.selection,b=a.getComponentAtStart(),c=this.blockToolbar.getButtonByName(b.paragraphType);this.blockToolbar.setActiveButton(c)},j.prototype.reloadInlineToolbarStatus=function(){var a=this.editor.article.selection,b=a.getComponentAtStart(),c=b.getSelectedFormatter(a),d=null,e={},f=null;c&&(d=this.getFormatterForValue(c.type),e=c.attrs,f=this.inlineToolbar.getButtonByName(c.type)),this.inlineToolbar.resetFields();for(var g in e){var h=f.getFieldByName(g);h.setValue(e[g])}this.inlineToolbar.setActiveButton(f)},j.prototype.handleBlockFormatterClicked=function(a){var b=a.detail.target.data;this.handleBlockFormatting(b.value),this.reloadBlockToolbarStatus(),a.preventDefault(),a.stopPropagation()},j.prototype.handleBlockFormatting=function(a){for(var b=this.editor.article.selection,c=b.getSelectedComponents(),e=[],g=b.getSectionAtStart(),h=b.start.offset,i=b.getComponentAtStart().getIndexInSection(),j=0;j<c.length;j++){var k=a;c[j].paragraphType===a&&(k=d.Types.Paragraph);var l=c[j].getIndexInSection()+j;f.arrays.extend(e,c[j].getDeleteOps(null,null,!0)),c[j].paragraphType=k,f.arrays.extend(e,c[j].getInsertOps(l))}this.editor.article.transaction(e),this.editor.dispatchEvent(new Event("change")),b.setCursor({offset:h,component:g.components[i]})},j.prototype.format=function(a,b,c){var d,e,g,h=[],i=a.getUpdateOps({formats:[]},b.start.offset,b.end.offset-b.start.offset),j=i[0]["do"],k=a.getFormattedRanges(c,!0);if(k&&k.length)for(var l=0;l<k.length;l++){var m=k[l];if(c.attrs){d=f.clone(j);var n=f.clone(m);n.attrs=c.attrs,d.formats.push(n),e=f.clone(j),e.formats.push(f.clone(m))}else c.to===m.to&&c.from===m.from?(d=f.clone(j),d.formats.push(f.clone(c)),e=d):c.to===m.to?(d=f.clone(j),d.formats.push(c),e=d):c.from===m.from?(d=f.clone(j),d.formats.push(c),e=d):c.to<m.to&&c.from>m.from?(d=f.clone(j),d.formats.push(m),d.formats.push({type:m.type,from:m.from,to:c.from,attrs:c.attrs}),d.formats.push({type:m.type,from:c.to,to:m.to,attrs:c.attrs}),e=f.clone(d),e.formats.reverse()):(d=f.clone(j),d.formats.push(m),d.formats.push({type:m.type,from:Math.min(m.from,c.from),to:Math.max(m.to,c.to)}),e=f.clone(d),e.formats.reverse())}else{var o=a.getFormatsForRange(c.from,c.to);d=f.clone(j),f.arrays.extend(d.formats,o),d.formats.push(c),e=f.clone(d),delete e.formats[e.formats.length-1].attrs,e.formats.reverse()}return g={"do":d,undo:e},h.push(g),h},j.prototype.handleInlineFormatterClicked=function(a){var b=a.detail.target.data,c=b.value;if(b.attrs){var d=this.editor.article.selection,e=d.getComponentAtStart(),f=e.getSelectedFormatter(d);f&&c===f.type?(this.handleInlineFormatting(c),this.reloadInlineToolbarStatus()):this.inlineToolbar.setActiveButton(a.detail.target)}else this.handleInlineFormatting(c),this.reloadInlineToolbarStatus();a.preventDefault(),a.stopPropagation()},j.prototype.handleInlineFormatting=function(a,b){var c=this.editor.article.selection,d=c.getComponentAtStart(),e={type:a,from:c.start.offset,to:c.end.offset,attrs:b};if(c.end.offset-c.start.offset!==0){var f=this.format(d,c,e);this.editor.article.transaction(f),this.editor.dispatchEvent(new Event("change"))}},j.prototype.handleKeyboardShortcut=function(a){var b=this.editor.shortcutsManager.getShortcutId(a),c=this.getInlineFormatterForShortcut(b);if(c)return this.handleInlineFormatting(c.value),!1;var d=this.getBlockFormatterForShortcut(b);return d?(this.handleBlockFormatting(d.value),!1):!0},j.prototype.getInlineFormatterForShortcut=function(a){for(var b=j.Actions.Inline,c=0;c<b.length;c++)if(-1!==b[c].shortcuts.indexOf(a))return b[c];return null},j.prototype.getBlockFormatterForShortcut=function(a){for(var b=j.Actions.Block,c=0;c<b.length;c++)if(-1!==b[c].shortcuts.indexOf(a))return b[c];return null},j.prototype.getFormatterForValue=function(a){for(var b=j.Actions.Block,c=0;c<b.length;c++)if(b[c].value===a)return b[c];var d=j.Actions.Inline;for(c=0;c<d.length;c++)if(d[c].value===a)return d[c];return null},j.getActionForTagName=function(a){a=a&&a.toLowerCase();for(var b=j.Actions.Inline,c=0;c<b.length;c++)if(-1!==b[c].tagNames.indexOf(a))return b[c];return null},j.generateFormatsForNode=function(a){for(var b=[],c=0,d=a.childNodes,e=0;e<d.length;e++){var g=d[e],h=j.getActionForTagName(g.tagName);if(h){var i={};for(var k in h.attrs)i[k]=g.getAttribute(k);b.push({type:h.value,from:c,to:c+f.getTextFromElement(g).length,attrs:i})}c+=g.textContent.length}return b}},{"../i18n":20,"../paragraph":27,"../selection":29,"../toolbars/button":30,"../toolbars/textField":31,"../utils":33}],13:[function(a,b,c){"use strict";var d=a("../utils"),e=a("../component"),f=a("../loader"),g=a("../i18n"),h=function(a){var b=d.extend({src:"",caption:null,width:"100%"},a);e.call(this,b),this.src=b.src,this.width=b.width,this.caption=b.caption,this.dom=document.createElement(h.CONTAINER_TAG_NAME),this.dom.setAttribute("contenteditable",!1),this.dom.setAttribute("name",this.name)};h.prototype=Object.create(e.prototype),b.exports=h,h.CLASS_NAME="GiphyComponent",f.register(h.CLASS_NAME,h),h.CONTAINER_TAG_NAME="figure",h.IMAGE_TAG_NAME="img",h.CAPTION_TAG_NAME="figcaption",h.GIPHY_SEARCH_REGEX="^\\+giphy\\s(.+[a-zA-Z])$",h.GIPHY_RANDOM_ENDPOINT="https://api.giphy.com/v1/gifs/random?api_key=dc6zaTOxFJmzC&tag=",h.fromJSON=function(a){return new h(a)},h.onInstall=function(a){h.registerRegexes_(a)},h.registerRegexes_=function(a){a.registerRegex(g.get("regex.giphy")||h.GIPHY_SEARCH_REGEX,h.handleMatchedRegex)},h.handleMatchedRegex=function(a,b){var c=a.text.split(/\s/).slice(1).join("+"),e=a.getIndexInSection(),f=[],g=new XMLHttpRequest;g.onreadystatechange=function(){if(4==g.readyState&&200==g.status){var c;if(c=JSON.parse(g.responseText).data.image_original_url){var i=new h({src:c});i.section=a.section,d.arrays.extend(f,a.getDeleteOps(e)),d.arrays.extend(f,i.getInsertOps(e)),b(f)}}},g.open("GET",h.GIPHY_RANDOM_ENDPOINT+c,!0),g.send()},h.prototype.getComponentClassName=function(){return h.CLASS_NAME},h.prototype.getJSONModel=function(){var a={component:h.CLASS_NAME,name:this.name,src:this.src,width:this.width,caption:this.caption};return a},h.prototype.render=function(a,b){this.isRendered||(e.prototype.render.call(this,a,b),this.imgDom=document.createElement(h.IMAGE_TAG_NAME),this.src&&(this.imgDom.setAttribute("src",this.src),this.width&&this.imgDom.setAttribute("width",this.width),this.dom.appendChild(this.imgDom)),this.editMode&&(this.dom.addEventListener("click",this.select.bind(this)),this.selectionDom=document.createElement("div"),this.selectionDom.innerHTML="&nbsp;",this.selectionDom.className="selection-pointer",this.selectionDom.setAttribute("contenteditable",!0),this.selectionDom.addEventListener("focus",this.select.bind(this)),this.dom.appendChild(this.selectionDom)))},h.prototype.getDeleteOps=function(a,b){var c=[{"do":{op:"deleteComponent",component:this.name,cursor:b},undo:{op:"insertComponent",componentClass:"GiphyComponent",section:this.section.name,component:this.name,index:this.getIndexInSection()+(a||0),attrs:{src:this.src,caption:this.caption,width:this.width}}}];return this.section.getLength()<2&&d.arrays.extend(c,this.section.getDeleteOps()),c},h.prototype.getInsertOps=function(a,b){return[{"do":{op:"insertComponent",componentClass:"GiphyComponent",section:this.section.name,cursorOffset:0,component:this.name,index:a,attrs:{src:this.src,width:this.width,caption:this.caption}},undo:{op:"deleteComponent",component:this.name,cursor:b}}]},h.prototype.getLength=function(){return 1}},{"../component":2,"../i18n":20,"../loader":25,"../utils":33}],14:[function(a,b,c){"use strict";var d=a("../selection"),e=a("../toolbars/toolbar"),f=a("../toolbars/button"),g=a("../i18n"),h=a("../figure"),i=a("../layout"),j=a("../utils"),k=a("../loader"),l=a("./embeddedComponent"),m=a("./giphyComponent"),n=function(){this.editor=null,this.toolbar=null};b.exports=n,n.CLASS_NAME="LayoutingExtension",n.onInstall=function(a){var b=new n;b.init(a)},n.onDestroy=function(){},n.prototype.init=function(a){this.editor=a,this.toolbar=new e({name:n.TOOLBAR_NAME,classNames:[n.TOOLBAR_CLASS_NAME],rtl:this.editor.rtl});for(var b=[{label:g.get("button.layout.single"),icon:g.get("button.layout.icon.single"),name:"layout-single-column"},{label:g.get("button.layout.bleed"),icon:g.get("button.layout.icon.bleed"),name:"layout-bleed"},{label:g.get("button.layout.staged"),icon:g.get("button.layout.icon.staged"),name:"layout-staged"},{label:g.get("button.layout.left"),icon:g.get("button.layout.icon.left"),name:"layout-float-left"},{label:g.get("button.layout.right"),icon:g.get("button.layout.icon.right"),name:"layout-float-right"}],c=0;c<b.length;c++){var h=new f({label:b[c].label,name:b[c].name,icon:b[c].icon,data:{name:b[c].name}});h.addEventListener("click",this.handleLayoutButtonClick.bind(this)),this.toolbar.addButton(h)}this.editor.registerToolbar(n.TOOLBAR_NAME,this.toolbar),this.editor.article.selection.addEventListener(d.Events.SELECTION_CHANGED,this.handleSelectionChangedEvent.bind(this))},n.TOOLBAR_NAME="layouting-toolbar",n.TOOLBAR_CLASS_NAME="layouting-toolbar",n.prototype.handleLayoutButtonClick=function(a){var b,c,d,e=[],f=this.editor.selection.getComponentAtStart(),g=f.getComponentClassName(),n=k.load(g);if(f instanceof h||f instanceof l||f instanceof m){this.toolbar.setActiveButton(a.detail.target);var o=f.section,p=a.detail.target.name,q=f.getIndexInSection(),r=0===q,s=q===o.getLength()-1;o.type!==p&&(1===o.getLength()?j.arrays.extend(e,o.getUpdateOps({type:p})):r||s?(b=o.getIndexInSection(),s&&b++,d=new i({type:p,section:o.section,components:[]}),j.arrays.extend(e,d.getInsertOps(b)),j.arrays.extend(e,f.getDeleteOps()),c=n.fromJSON(f.getJSONModel()),c.section=d,j.arrays.extend(e,c.getInsertOps(0))):(b=o.getIndexInSection()+1,d=new i({type:p,section:o.section,components:[]}),j.arrays.extend(e,o.getSplitOps(q)),j.arrays.extend(e,f.getDeleteOps()),j.arrays.extend(e,d.getInsertOps(b)),c=n.fromJSON(f.getJSONModel()),c.section=d,j.arrays.extend(e,c.getInsertOps(0))),this.editor.article.transaction(e),this.editor.dispatchEvent(new Event("change")))}this.handleSelectionChangedEvent()},n.prototype.handleSelectionChangedEvent=function(){var a=this.editor.selection.getComponentAtStart();if(a instanceof h&&!a.isDataUrl||a instanceof l||a instanceof m){var b=a.section.type,c=this.toolbar.getButtonByName(b);this.toolbar.setActiveButton(c),this.toolbar.setPositionToTopOf(a.dom),this.toolbar.setVisible(!0)}else this.toolbar.setVisible(!1)},n.prototype.handleButtonAdded=function(){this.insertButton.setVisible(!0)}},{"../figure":19,"../i18n":20,"../layout":23,"../loader":25,"../selection":29,"../toolbars/button":30,"../toolbars/toolbar":32,"../utils":33,"./embeddedComponent":9,"./giphyComponent":13}],15:[function(a,b,c){"use strict";var d=a("../utils"),e=a("./attachment"),f=a("../figure"),g=a("../toolbars/button"),h=a("../i18n"),i=function(a){var b=d.extend({editor:null},a);this.camDom=document.getElementById(i.CAM_PREVIEW_ELEMENT_ID),this.camDom||(this.camDom=document.createElement("div"),this.camDom.style.position="absolute",this.camDom.style.top="-9999px",this.camDom.style.left="-9999px",this.camDom.setAttribute("id",i.CAM_PREVIEW_ELEMENT_ID),document.body.appendChild(this.camDom)),Webcam.set({width:320,height:240,dest_width:1280,dest_height:720,crop_width:1280,crop_height:720,image_format:"jpeg",jpeg_quality:90}),this.editor=b.editor,this.toolbelt=this.editor.getToolbar(i.TOOLBELT_TOOLBAR_NAME)};b.exports=i,i.CLASS_NAME="SelfieExtension",i.CAM_PREVIEW_ELEMENT_ID="carbon-camera",i.COMMAND_REGEX="^\\+selfie$",i.ATTACHMENT_ADDED_EVENT_NAME="attachment-added",i.TOOLBELT_TOOLBAR_NAME="toolbelt-toolbar",i.onInstall=function(a){if(!Webcam)return void console.error("SelfieExtension depends on Webcam.js being loaded. Make sure to include it in your app.");var b=new i({editor:a});b.init()},i.prototype.init=function(){this.editor.registerRegex(h.get("regex.selfie")||i.COMMAND_REGEX,this.handleMatchedRegex.bind(this));var a=new g({label:h.get("button.selfie"),icon:h.get("button.icon.selfie")});a.addEventListener("click",this.handleInsertClicked.bind(this)),this.toolbelt.addButton(a)},i.prototype.letMeTakeASelfie=function(a){var b=this,c=[];Webcam.attach("#"+i.CAM_PREVIEW_ELEMENT_ID),Webcam.on("live",function(){setTimeout(function(){Webcam.snap(function(g){var h=b.editor.article.selection,j=h.getComponentAtStart(),k=j.getIndexInSection(),l=new f({src:g});l.section=h.getSectionAtStart();var m=l.getInsertOps(k);d.arrays.extend(c,l.getInsertOps(k)),a&&a(c);var n=new e({dataUri:g,figure:h.getSectionAtStart().getComponentByName(l.name),editor:b.editor,insertedOps:m}),o=new CustomEvent(i.ATTACHMENT_ADDED_EVENT_NAME,{detail:{attachment:n}});b.editor.dispatchEvent(o)}),Webcam.off("live"),Webcam.reset()},1e3)})},i.prototype.handleMatchedRegex=function(a,b){var c=[],e=a.getIndexInSection();d.arrays.extend(c,a.getDeleteOps(e)),this.letMeTakeASelfie(function(a){d.arrays.extend(c,a),b(c)})},i.prototype.handleInsertClicked=function(){var a=this;this.letMeTakeASelfie(function(b){a.editor.article.transaction(b),a.editor.dispatchEvent(new Event("change"))})}},{"../figure":19,"../i18n":20,"../toolbars/button":30,"../utils":33,"./attachment":6}],16:[function(a,b,c){"use strict";var d=function(a){this.editor=a,this.registery={},this.editor.element.addEventListener("keydown",this.handleKeyDownEvent.bind(this))};b.exports=d,d.META_KEYS=[16,17,91],d.prototype.getShortcutId=function(a){var b=[],c=a.keyCode||a.which;return-1!==d.META_KEYS.indexOf(c)?!1:(a.metaKey&&b.push("cmd"),a.ctrlKey&&b.push("ctrl"),a.shiftKey&&b.push("shift"),a.altKey&&b.push("alt"),b.sort(),c&&b.push(String.fromCharCode(c)),b.join("+").toLowerCase())},d.prototype.isShortcutEvent=function(a){var b=a.keyCode||a.which;return(a.metaKey||a.ctrlKey)&&b&&-1===d.META_KEYS.indexOf(b)},d.prototype.handleKeyDownEvent=function(a){if(this.isShortcutEvent(a)){var b=this.getShortcutId(a);if(this.registery[b]){var c=this.registery[b](a);if(c===!1)return a.preventDefault(),a.stopPropagation(),!1}}return!0},d.prototype.register=function(a,b,c){if(this.registery[a]&&!c)throw'"'+a+'" shortcut has already been registered.';this.registery[a]=b},d.prototype.onDestroy=function(){this.registery={}}},{}],17:[function(a,b,c){"use strict";var d=a("../selection"),e=a("../toolbars/toolbar"),f=a("../toolbars/button"),g=function(){this.editor=null,this.toolbar=null,this.blockToolbar=null,this.insertButton=new f({label:"+"}),this.insertButton.setVisible(!1),this.insertButton.addEventListener("click",this.handleInsertClick.bind(this))};b.exports=g,g.CLASS_NAME="Toolbelt",g.onInstall=function(a){var b=new g;b.init(a)},g.onDestroy=function(){},g.prototype.init=function(a){this.editor=a,this.blockToolbar=this.editor.getToolbar(g.BLOCK_TOOLBAR_NAME),this.blockToolbar.addButton(this.insertButton),this.toolbar=new e({name:g.TOOLBELT_TOOLBAR_NAME,classNames:[g.TOOLBELT_TOOLBAR_CLASS_NAME],rtl:this.editor.rtl}),this.toolbar.addEventListener("button-added",this.handleButtonAdded.bind(this)),this.editor.registerToolbar(g.TOOLBELT_TOOLBAR_NAME,this.toolbar),this.editor.article.selection.addEventListener(d.Events.SELECTION_CHANGED,this.handleSelectionChangedEvent.bind(this))},g.TOOLBELT_TOOLBAR_NAME="toolbelt-toolbar",g.TOOLBELT_TOOLBAR_CLASS_NAME="toolbelt-toolbar",g.BLOCK_TOOLBAR_NAME="block-toolbar",g.prototype.handleInsertClick=function(){this.toolbar.setPositionToStartBottomOf(this.insertButton.dom),this.toolbar.setVisible(!this.toolbar.isVisible)},g.prototype.handleSelectionChangedEvent=function(){this.toolbar.setVisible(!1)},g.prototype.handleButtonAdded=function(){this.insertButton.setVisible(!0);
}},{"../selection":29,"../toolbars/button":30,"../toolbars/toolbar":32}],18:[function(a,b,c){"use strict";var d=a("../toolbars/button"),e=a("../utils"),f=a("../figure"),g=a("./attachment"),h=a("../i18n"),i=function(a){var b=e.extend({label:"Upload",icon:""},a);d.call(this,b),this.dom.classList.add(i.UPLOAD_CONTAINER_CLASS_NAME),this.uploadButtonDom=document.createElement(i.TAG_NAME),this.uploadButtonDom.setAttribute("type","file"),this.uploadButtonDom.setAttribute("name",this.name),this.uploadButtonDom.setAttribute("multiple",!0),this.uploadButtonDom.addEventListener("change",this.handleChange.bind(this)),this.dom.appendChild(this.uploadButtonDom)};i.prototype=Object.create(d.prototype),i.UPLOAD_CONTAINER_CLASS_NAME="upload-button",i.TAG_NAME="input",i.prototype.handleChange=function(a){var b={target:this,files:a.target.files},c=new CustomEvent("change",{detail:b});this.dispatchEvent(c),a.target.value=""};var j=function(){this.editor=null,this.toolbelt=null};b.exports=j,j.CLASS_NAME="UploadExtension",j.TOOLBELT_TOOLBAR_NAME="toolbelt-toolbar",j.ATTACHMENT_ADDED_EVENT_NAME="attachment-added",j.onInstall=function(a){var b=new j;b.init(a)},j.onDestroy=function(){},j.prototype.init=function(a){this.editor=a,this.toolbelt=this.editor.getToolbar(j.TOOLBELT_TOOLBAR_NAME);var b=new i({label:h.get("button.upload"),icon:h.get("button.icon.upload")});b.addEventListener("change",this.handleUpload.bind(this)),this.toolbelt.addButton(b)},j.prototype.handleUpload=function(a){for(var b=this,c=a.detail.files,d=function(a,c){var d=b.editor.article.selection,e=d.getComponentAtStart(),h=new f({src:a});h.section=d.getSectionAtStart();var i=h.getInsertOps(e.getIndexInSection());b.editor.article.transaction(i),b.editor.dispatchEvent(new Event("change"));var k=new g({file:c,figure:d.getComponentAtStart(),editor:b.editor,insertedOps:i}),l=new CustomEvent(j.ATTACHMENT_ADDED_EVENT_NAME,{detail:{attachment:k}});b.editor.dispatchEvent(l)},e=0;e<c.length;e++)this.readFileAsDataUrl_(c[e],d)},j.prototype.readFileAsDataUrl_=function(a,b){var c=new FileReader;c.onload=function(a){return function(c){b(c.target.result,a)}}(a),c.readAsDataURL(a)}},{"../figure":19,"../i18n":20,"../toolbars/button":30,"../utils":33,"./attachment":6}],19:[function(a,b,c){"use strict";var d=a("./utils"),e=a("./component"),f=a("./paragraph"),g=a("./loader"),h=a("./i18n"),i=function(a){var b=d.extend({src:"",caption:null,captionPlaceholder:h.get("placeholder.figure"),width:"100%",height:null},a);e.call(this,b),this.src=b.src,this.isDataUrl=!!b.src&&0===b.src.indexOf("data:image"),this.width=b.width,this.height=b.height,this.caption=b.caption,this.captionPlaceholder=b.captionPlaceholder,this.captionParagraph=new f({placeholderText:b.captionPlaceholder,name:this.name+"-caption",text:b.caption,paragraphType:f.Types.Caption,parentComponent:this,inline:!0}),this.dom=document.createElement(i.CONTAINER_TAG_NAME),this.dom.setAttribute("contenteditable",!1),this.dom.setAttribute("name",this.name)};i.prototype=Object.create(e.prototype),b.exports=i,i.CLASS_NAME="Figure",g.register(i.CLASS_NAME,i),i.CONTAINER_TAG_NAME="figure",i.IMAGE_CONTAINER_TAG_NAME="div",i.IMAGE_CONTAINER_CLASS_NAME="image-container",i.IMAGE_TAG_NAME="img",i.CAPTION_TAG_NAME="figcaption",i.IMAGE_URL_REGEXS=["https?://(.*).(jpg|png|gif|jpeg)$"],i.fromJSON=function(a){return new i(a)},i.onInstall=function(a){i.registerRegexes_(a)},i.registerRegexes_=function(a){for(var b=0;b<i.IMAGE_URL_REGEXS.length;b++)a.registerRegex(i.IMAGE_URL_REGEXS[b],i.handleMatchedRegex)},i.handleMatchedRegex=function(a,b){var c=a.text,e=a.getIndexInSection(),f=[],g=new i({src:c});g.section=a.section,d.arrays.extend(f,a.getDeleteOps(e)),d.arrays.extend(f,g.getInsertOps(e)),b(f)},i.prototype.getComponentClassName=function(){return i.CLASS_NAME},i.prototype.getJSONModel=function(){var a={component:i.CLASS_NAME,name:this.name,width:this.width,height:this.height,caption:this.captionParagraph.text};return this.isDataUrl||(a.src=this.src),a},i.prototype.render=function(a,b){this.isRendered||(e.prototype.render.call(this,a,b),this.src&&(this.imgDom=document.createElement(i.IMAGE_TAG_NAME),this.imgDom.setAttribute("src",this.src),this.imgContainerDom=document.createElement(i.IMAGE_CONTAINER_TAG_NAME),this.width&&this.height&&(this.imgContainerDom.className=i.IMAGE_CONTAINER_CLASS_NAME,this.imgContainerDom.style.paddingBottom=parseInt(this.height)/parseInt(this.width)*100+"%"),this.imgContainerDom.appendChild(this.imgDom),this.dom.appendChild(this.imgContainerDom)),this.captionParagraph.render(this.dom,{editMode:this.editMode}),this.editMode&&(this.src&&(this.imgDom.addEventListener("click",this.select.bind(this)),this.selectionDom=document.createElement("div"),this.selectionDom.innerHTML="&nbsp;",this.selectionDom.className="selection-pointer",this.selectionDom.setAttribute("contenteditable",!0),this.selectionDom.addEventListener("focus",this.select.bind(this)),this.dom.appendChild(this.selectionDom)),this.captionParagraph.dom.setAttribute("contenteditable",!0),!this.imgDom||this.width&&this.height||this.imgDom.addEventListener("load",function(){if(this.editMode){var a=window.getComputedStyle(this.imgDom);this.width=a.width,this.height=a.height}}.bind(this))))},i.prototype.getDeleteOps=function(a,b){var c=[{"do":{op:"deleteComponent",component:this.name,cursor:b},undo:{op:"insertComponent",componentClass:"Figure",section:this.section.name,component:this.name,index:this.getIndexInSection()+(a||0),attrs:{src:this.src,caption:this.captionParagraph.text,width:this.width}}}];return this.section.getLength()<2&&d.arrays.extend(c,this.section.getDeleteOps()),c},i.prototype.getInsertOps=function(a,b){return[{"do":{op:"insertComponent",componentClass:"Figure",section:this.section.name,cursorOffset:0,component:this.name,index:a,attrs:{src:this.src,width:this.width,caption:this.captionParagraph.text}},undo:{op:"deleteComponent",component:this.name,cursor:b}}]},i.prototype.getLength=function(){return 1},i.prototype.updateAttributes=function(a){a.src&&this.updateSource(a.src),a.caption&&this.updateCaption(a.caption)},i.prototype.updateSource=function(a){this.src=a,this.isDataUrl=!!this.src&&0!==this.src.indexOf("http"),this.imgDom.setAttribute("src",a)},i.prototype.updateCaption=function(a){this.caption=a,this.captionParagraph.setText(a)}},{"./component":2,"./i18n":20,"./loader":25,"./paragraph":27,"./utils":33}],20:[function(a,b,c){"use strict";var d={};b.exports=d,d.LANG_STRING_MAP={},d.fallbackLocale="en",d.currentLocale="en",d.getCurrentLocale=function(){return d.currentLocale},d.setCurrentLocale=function(a){d.currentLocale=a},d.getFallbackLocale=function(){return d.fallbackLocale},d.setFallbackLocale=function(a){d.fallbackLocale=a},d.set=function(a,b,c){d.LANG_STRING_MAP[a]||(d.LANG_STRING_MAP[a]={}),d.LANG_STRING_MAP[a][b]=c},d.get=function(a,b){var c=b||d.currentLocale;return d.LANG_STRING_MAP[c]&&d.LANG_STRING_MAP[c][a]||(c=d.getFallbackLocale()),d.LANG_STRING_MAP[c][a]}},{}],21:[function(a,b,c){"use strict";var d=a("../i18n");d.set("ar","placeholder.figure","Ø§ÙƒØªØ¨ ÙˆØµÙ Ù„Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"),d.set("ar","placeholder.embed","Ø§ÙƒØªØ¨ ÙˆØµÙ Ù„Ù„ØªØ¶Ù…ÙŠÙ† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"),d.set("ar","placeholder.href","Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø±Ø§Ø¨Ø·ØŸ"),d.set("ar","placeholder.video","Ø£Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ØŒ ÙØ§ÙŠÙ†ØŒ ÙÙŠØ¯ÙŠÙˆ ÙÙŠØ³Ø¨ÙˆÙƒØŒ Ø³Ø§ÙˆÙ†Ø¯ ÙƒÙ„Ø§ÙˆØ¯ Ø£Ùˆ ØºÙŠØ±Ù‡Ø§..."),d.set("ar","placeholder.photo","Ø£Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· Ù„ØµÙˆØ±Ø©ØŒ ØµÙˆØ±Ø© ÙÙŠØ³Ø¨ÙˆÙƒØŒ Ø¥Ù†Ø³ØªØºØ±Ø§Ù… Ø£Ùˆ ØºÙŠØ±Ù‡Ø§..."),d.set("ar","placeholder.post","Ø£Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· Ù„ÙÙŠØ³Ø¨ÙˆÙƒØŒ ØªÙˆÙŠØªØ±ØŒ Ø¬ÙŠØªÙ‡Ø§Ø¨ Ø¬ÙŠØ³Øª Ø£Ùˆ ØºÙŠØ±Ù‡Ø§..."),d.set("ar","placeholder.gif","Ø§ÙƒØªØ¨ +Ø¬ÙŠÙÙŠ <Ù†Øµ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ù„Ù„Ø¨Ø­Ø«> ÙˆØ§Ø¶ØºØ· Ø²Ø± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø£Ùˆ Ø£Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· Ù…Ù† Ø¬ÙŠÙÙŠ..."),d.set("ar","placeholder.quiz","Ø£Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· Ù…Ù† qzzr.com Ø£Ùˆ slideshare Ø£Ùˆ ØºÙŠØ±Ù‡Ø§..."),d.set("ar","button.upload","ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø©"),d.set("ar","button.video","Ø£Ø¯Ø®Ù„ ÙÙŠØ¯ÙŠÙˆ"),d.set("ar","button.photo","Ø£Ø¯Ø®Ù„ ØµÙˆØ±Ø© Ø¨Ø±Ø§Ø¨Ø·"),d.set("ar","button.post","ØªØ¶Ù…ÙŠÙ† Ù…Ù†Ø´ÙˆØ±"),d.set("ar","button.gif","Ø£Ø¯Ø®Ù„ GIF"),d.set("ar","button.quiz","Ø£Ø¯Ø®Ù„ Ø¹Ø±Ø¶"),d.set("ar","button.selfie","Ù†ÙØµÙˆØ±Ø©!"),d.set("ar","button.layout.single","Ø®Ø§Ù†Ø©"),d.set("ar","button.layout.bleed","Ø±Ù"),d.set("ar","button.layout.staged","Ù…Ø³Ø±Ø­"),d.set("ar","button.layout.left","Ø´Ù…Ø§Ù„"),d.set("ar","button.layout.right","ÙŠÙ…ÙŠÙ†"),d.set("ar","regex.giphy","^\\+Ø¬ÙŠÙÙŠ\\s(.+[a-zA-Z])$"),d.set("ar","regex.selfie","^\\+(?:Ù†ÙØµÙˆØ±[Ø©|Ù‡]|Ø³ÙŠ?Ù„ÙÙŠ)$")},{"../i18n":20}],22:[function(a,b,c){"use strict";var d=a("../i18n");d.set("en","placeholder.figure","Enter caption for image (optional)"),d.set("en","placeholder.embed","Enter caption for embed (optional)"),d.set("en","placeholder.href","What is the URL?"),d.set("en","placeholder.video","Paste a link for YouTube, Vine, FB Video, SoundCloud and others."),d.set("en","placeholder.photo","Paste a link for a photo, FB photo, Instagram and others."),d.set("en","placeholder.post","Paste a link for a Facebook post, Tweet, Github Gist and others."),d.set("en","placeholder.gif","Type /giphy <search-term> (enter) or paste a link to giphy or gif image url."),d.set("en","placeholder.quiz","Paste a link to qzzr.com or slideshare or others."),d.set("en","button.upload","Upload Photo"),d.set("en","button.video","Insert Video"),d.set("en","button.photo","Insert Photo by URL"),d.set("en","button.post","Embed Post"),d.set("en","button.gif","Insert GIF"),d.set("en","button.quiz","Insert Quiz or Slides"),d.set("en","button.selfie","Selfie!"),d.set("en","button.icon.upload","fa fa-upload"),d.set("en","button.icon.video","fa fa-youtube-play"),d.set("en","button.icon.photo","fa fa-picture-o"),d.set("en","button.icon.post","fa fa-twitter"),d.set("en","button.icon.gif","fa fa-child"),d.set("en","button.icon.quiz","fa fa-question"),d.set("en","button.icon.selfie","fa fa-camera"),d.set("en","button.layout.single","Column"),d.set("en","button.layout.bleed","Shelf"),d.set("en","button.layout.staged","Stage"),d.set("en","button.layout.left","Left"),d.set("en","button.layout.right","Right"),d.set("en","button.layout.icon.single","fa fa-align-justify"),d.set("en","button.layout.icon.bleed","fa fa-arrows-h"),d.set("en","button.layout.icon.staged","fa fa-desktop"),d.set("en","button.layout.icon.left","fa fa-align-left"),d.set("en","button.layout.icon.right","fa fa-align-right"),d.set("en","regex.giphy","^\\+giphy\\s(.+[a-zA-Z])$"),d.set("en","regex.selfie","^\\+selfie$")},{"../i18n":20}],23:[function(a,b,c){"use strict";var d=a("./utils"),e=a("./section"),f=a("./paragraph"),g=a("./loader"),h=function(a){var b=d.extend({tagName:h.LAYOUT_TAG_NAME,type:h.Types.SingleColumn,components:[new f({paragraphType:f.Types.Paragraph})]},a);e.call(this,b),this.type=b.type,this.dom.setAttribute("contenteditable",!1),this.dom.classList.add("carbon-layout"),this.dom.classList.add(this.type)};h.prototype=Object.create(e.prototype),b.exports=h,h.CLASS_NAME="Layout",g.register(h.CLASS_NAME,h),h.LAYOUT_TAG_NAME="div",h.Types={SingleColumn:"layout-single-column",Bleed:"layout-bleed",Staged:"layout-staged",FloatLeft:"layout-float-left",FloatRight:"layout-float-right"},h.fromJSON=function(a){for(var b=[],c=0;c<a.components.length;c++){var d=a.components[c].component,e=g.load(d);b.push(e.fromJSON(a.components[c]))}return new h({tagName:a.tagName,name:a.name,type:a.type,components:b})},h.onInstall=function(){},h.prototype.getComponentClassName=function(){return h.CLASS_NAME},h.prototype.getDeleteOps=function(a){var b=[{"do":{op:"deleteComponent",component:this.name},undo:{op:"insertComponent",componentClass:"Layout",section:this.section.name,component:this.name,index:this.getIndexInSection()+(a||0),attrs:{components:this.components,tagName:this.tagName,type:this.type}}}];if(this.section.getLength()<2){var c=new h({name:this.name,components:[]});c.section=this.section,d.arrays.extend(b,c.getInsertOps(0))}return b},h.prototype.getInsertOps=function(a){return[{"do":{op:"insertComponent",componentClass:"Layout",section:this.section.name,cursorOffset:0,component:this.name,index:a,attrs:{components:this.components,tagName:this.tagName,type:this.type}},undo:{op:"deleteComponent",component:this.name}}]},h.prototype.getSplitOps=function(a){var b=[],c=a,e=0;for(c=a;c<this.components.length;c++)d.arrays.extend(b,this.components[c].getDeleteOps(e--));var f=new h({tagName:this.tagName,section:this.section,components:[]});for(d.arrays.extend(b,f.getInsertOps(this.getIndexInSection()+1)),c=a;c<this.components.length;c++){var i=this.components[c].getComponentClassName(),j=g.load(i),k=j.fromJSON(this.components[c].getJSONModel());k.section=f,d.arrays.extend(b,k.getInsertOps(c-a))}return b},h.prototype.getUpdateOps=function(a,b,c){return[{"do":{op:"updateComponent",component:this.name,cursorOffset:b,selectRange:c,attrs:{type:a.type}},undo:{op:"updateComponent",component:this.name,cursorOffset:b,selectRange:c,attrs:{type:this.type}}}]},h.prototype.updateType=function(a){this.dom.classList.remove(this.type),this.type=a,this.dom.classList.add(this.type)},h.prototype.updateAttributes=function(a){a.type&&this.updateType(a.type)},h.prototype.getLength=function(){return this.components.length},h.prototype.getJSONModel=function(){for(var a={name:this.name,tagName:this.tagName,type:this.type,component:h.CLASS_NAME,components:[]},b=0;b<this.components.length;b++)a.components.push(this.components[b].getJSONModel());return a}},{"./loader":25,"./paragraph":27,"./section":28,"./utils":33}],24:[function(a,b,c){"use strict";var d=a("./utils"),e=a("./section"),f=a("./paragraph"),g=a("./loader"),h=function(a){var b=d.extend({tagName:h.UNORDERED_LIST_TAG,components:[new f({paragraphType:f.Types.ListItem})]},a);e.call(this,b)};h.prototype=Object.create(e.prototype),b.exports=h,h.CLASS_NAME="List",g.register(h.CLASS_NAME,h),h.UNORDERED_LIST_TAG="UL",h.ORDERED_LIST_TAG="OL",h.UNORDERED_LIST_REGEX="^(?:\\*|-)\\s?(.*)",h.ORDERED_LIST_REGEX="^(?:1\\.|-|_|\\))\\s?(.*)",h.fromJSON=function(a){for(var b=[],c=0;c<a.components.length;c++){var d=a.components[c].component,e=g.load(d);b.push(e.fromJSON(a.components[c]))}return new h({tagName:a.tagName,name:a.name,components:b})},h.onInstall=function(a){h.registerRegexes_(a)},h.registerRegexes_=function(a){a.registerRegex(h.UNORDERED_LIST_REGEX,h.handleULMatchedRegex),a.registerRegex(h.ORDERED_LIST_REGEX,h.handleOLMatchedRegex)},h.createListOpsForMatchedRegex_=function(a,b,c){var e=a.getIndexInSection(),g=[],i=new h({tagName:c,section:a.section,components:[new f({text:b,paragraphType:f.Types.ListItem})]});d.arrays.extend(g,a.getDeleteOps(e)),d.arrays.extend(g,i.getInsertOps(e));var j=new f({paragraphType:f.Types.ListItem,section:i});return d.arrays.extend(g,j.getInsertOps(1)),g},h.handleULMatchedRegex=function(a,b){var c=new RegExp(h.UNORDERED_LIST_REGEX),d=c.exec(a.text),e=d[1],f=h.createListOpsForMatchedRegex_(a,e,h.UNORDERED_LIST_TAG);b(f)},h.handleOLMatchedRegex=function(a,b){var c=new RegExp(h.ORDERED_LIST_REGEX),d=c.exec(a.text),e=d[1],f=h.createListOpsForMatchedRegex_(a,e,h.ORDERED_LIST_TAG);b(f)},h.prototype.getComponentClassName=function(){return h.CLASS_NAME},h.prototype.getDeleteOps=function(a,b){return[{"do":{op:"deleteComponent",component:this.name,cursor:b},undo:{op:"insertComponent",componentClass:"List",section:this.section.name,component:this.name,index:this.getIndexInSection()+(a||0),attrs:{components:this.components,tagName:this.tagName}}}]},h.prototype.getInsertOps=function(a,b){return[{"do":{op:"insertComponent",componentClass:"List",section:this.section.name,cursorOffset:0,component:this.name,index:a,attrs:{components:this.components,tagName:this.tagName}},undo:{op:"deleteComponent",component:this.name,cursor:b}}]},h.prototype.getSplitOps=function(a){var b=[],c=a;for(c=a;c<this.components.length;c++)d.arrays.extend(b,this.components[c].getDeleteOps());var e=new h({tagName:this.tagName,section:this.section,components:[]});for(d.arrays.extend(b,e.getInsertOps(this.getIndexInSection()+1)),c=a;c<this.components.length;c++){var f=this.components[c].getComponentClassName(),i=g.load(f),j=i.fromJSON(this.components[c].getJSONModel());j.section=e,d.arrays.extend(b,j.getInsertOps(c-a))}return b},h.prototype.getLength=function(){return this.components.length},h.prototype.getJSONModel=function(){for(var a={name:this.name,tagName:this.tagName,component:h.CLASS_NAME,components:[]},b=0;b<this.components.length;b++)a.components.push(this.components[b].getJSONModel());return a}},{"./loader":25,"./paragraph":27,"./section":28,"./utils":33}],25:[function(a,b,c){"use strict";var d=a("./errors"),e=function(){var a=function(){this.registery={}};a.prototype.register=function(a,b,c){if(this.registery[a]&&!c)throw d.AlreadyRegisteredError('The module name "'+a+'" has already been registered.');this.registery[a]=b},a.prototype.load=function(a){return this.registery[a]};var b=new a;return{register:function(a,c,d){b.register(a,c,d)},load:function(a){return b.load(a)}}}();b.exports=e},{"./errors":4}],26:[function(a,b,c){"use strict";b.exports.I18n=a("./i18n"),a("./i18n/en"),a("./i18n/ar"),b.exports.Editor=a("./editor"),b.exports.Article=a("./article"),b.exports.Paragraph=a("./paragraph"),b.exports.List=a("./list"),b.exports.Figure=a("./figure"),b.exports.Section=a("./section"),b.exports.Layout=a("./layout"),b.exports.Selection=a("./selection"),b.exports.Loader=a("./loader"),b.exports.GiphyComponent=a("./extensions/giphyComponent"),b.exports.EmbeddedComponent=a("./extensions/embeddedComponent"),b.exports.AbstractEmbedProvider=a("./extensions/abstractEmbedProvider"),b.exports.EmbedlyProvider=a("./extensions/embedlyProvider"),b.exports.CarbonEmbedProvider=a("./extensions/carbonEmbedProvider"),b.exports.EmbeddingExtension=a("./extensions/embeddingExtension"),b.exports.SelfieExtension=a("./extensions/selfieExtension"),b.exports.LayoutingExtension=a("./extensions/layoutingExtension")},{"./article":1,"./editor":3,"./extensions/abstractEmbedProvider":5,"./extensions/carbonEmbedProvider":7,"./extensions/embeddedComponent":9,"./extensions/embeddingExtension":10,"./extensions/embedlyProvider":11,"./extensions/giphyComponent":13,"./extensions/layoutingExtension":14,"./extensions/selfieExtension":15,"./figure":19,"./i18n":20,"./i18n/ar":21,"./i18n/en":22,"./layout":23,"./list":24,"./loader":25,"./paragraph":27,"./section":28,"./selection":29}],27:[function(a,b,c){"use strict";var d=a("./utils"),e=a("./component"),f=a("./loader"),g=function(a){var b=d.extend({text:"",placeholderText:null,paragraphType:g.Types.Paragraph,formats:[]},a);e.call(this,b),this.text=b.text,this.placeholderText=b.placeholderText,this.formats=b.formats,this.paragraphType=b.paragraphType,this.dom=document.createElement(this.paragraphType),this.dom.setAttribute("name",this.name),this.setText(b.text),this.formats&&this.updateInnerDom_()};g.prototype=Object.create(e.prototype),b.exports=g,g.CLASS_NAME="Paragraph",f.register(g.CLASS_NAME,g),g.EMPTY_PARAGRAPH_CLASS="empty-paragraph",g.Types={Paragraph:"p",MainHeader:"h1",SecondaryHeader:"h2",ThirdHeader:"h3",Quote:"blockquote",Code:"pre",Caption:"figcaption",ListItem:"li"},g.fromJSON=function(a){return new g(a)},g.onInstall=function(a){},g.prototype.getComponentClassName=function(){return g.CLASS_NAME},g.prototype.isHeader=function(){return-1!==[g.Types.MainHeader,g.Types.SecondaryHeader,g.Types.ThirdHeader].indexOf(this.paragraphType)},g.prototype.setText=function(a){this.text=a||"",a&&(this.text=a.replace(/(\S)\s(\S)/g,"$1 $2").replace(/\s$/g,"Â ").replace(/(\s{2,})/g,function(a){return new Array(a.length+1).join("Â ")}),this.text.length>1&&(this.text=this.text.replace("â€‹","").replace(/^\s/,"Â "))),this.text.replace(/\s/,"").length?(this.dom.classList.remove("show-placeholder"),d.setTextForElement(this.dom,this.text)):(this.dom.innerHTML="&#8203;",this.dom.classList.add("show-placeholder"))},g.prototype.getWordAt_=function(a){var b=this.getWordStart_(a),c=this.getWordEnd_(a);return c>b?this.text.substring(b,c):void 0},g.prototype.getWordStart_=function(a){var b;for(b=a-1;b>0&&(!this.text[b]||!this.text[b].match(/\s/));b--);return 0===b?0:b+1},g.prototype.getWordEnd_=function(a){var b;for(b=a;b<this.getLength()&&(!this.text[b]||!this.text[b].match(/\s/));b++);return 0===b?0:b},g.prototype.insertCharactersAt=function(a,b){var c=[this.text.substring(0,b),this.text.substring(b)],d=c.join(a);this.shiftFormatsFrom_(b,a.length),this.setText(d),this.updateInnerDom_()},g.prototype.removeCharactersAt=function(a,b){var c=[this.text.substring(0,a),this.text.substring(a+b)],d=c.join("");this.shiftFormatsFrom_(a,-1*b),this.setText(d),this.updateInnerDom_()},g.prototype.shiftFormatsFrom_=function(a,b){for(var c=[],d=0;d<this.formats.length;d++)a<=this.formats[d].from&&a-b>=this.formats[d].to&&c.push(d),this.formats[d].from>=a&&(this.formats[d].from+=b),this.formats[d].to>a&&(this.formats[d].to+=b);for(d=0;d<c.length;d++)this.formats.splice(c[d],1)},g.prototype.updateInnerDom_=function(){if(!this.formats.length)return void this.setText(this.text);for(var a,b=document.createElement(this.paragraphType),c=0,e=0,f=0;f<this.formats.length;f++){c=this.formats[f].from,c-e>0&&(a=this.text.substring(e,c),b.appendChild(document.createTextNode(a))),e=this.formats[f].to;var g=document.createElement(this.formats[f].type);for(var h in this.formats[f].attrs)g.setAttribute(h,this.formats[f].attrs[h]);d.setTextForElement(g,this.text.substring(c,e)),b.appendChild(g)}var i=this.text.length;i-e>0&&(a=this.text.substring(i,e),b.appendChild(document.createTextNode(a))),this.dom.innerHTML=b.innerHTML},g.prototype.isPlaceholder=function(){return!!this.placeholderText&&!this.text.length},g.prototype.applyFormats=function(a){for(var b=0;b<a.length;b++)this.format(a[b])},g.prototype.getSelectedFormatter=function(a){for(var b=0;b<this.formats.length;b++)if(a.start.offset>=this.formats[b].from&&a.start.offset<this.formats[b].to&&a.end.offset>this.formats[b].from&&a.end.offset<=this.formats[b].to)return this.formats[b];return null},g.prototype.format=function(a,b){a=d.clone(a);var c=this.getFormattedRanges(a,!b);if(c&&c.length)for(var e=d.clone(c),f=0;f<e.length;f++){var g=e[f],h=this.formats.indexOf(c[f]);a.attrs?(g.attrs=a.attrs,this.formats[h]=g):a.to===g.to&&a.from===g.from?this.formats.splice(h,1):a.to===g.to||a.to>g.to&&a.from<g.to&&b?(g.to=a.from,this.formats[h]=g):a.from===g.from||a.from<g.from&&a.to>g.from&&b?(g.from=a.to,this.formats[h]=g):a.to<g.to&&a.from>g.from?(this.formats.splice(h,1),this.addNewFormatting({type:g.type,from:g.from,to:a.from}),this.addNewFormatting({type:g.type,from:a.to,to:g.to})):b?this.formats.splice(h,1):(g.from=Math.min(g.from,a.from),g.to=Math.max(g.to,a.to),this.formats[h]=g)}else{var i=this.getFormattedRanges(a,!1);i&&i.length?b||(this.format(a,!0),this.format(a)):this.addNewFormatting(a)}b||this.normalizeFormats_(),this.updateInnerDom_()},g.prototype.normalizeFormats_=function(){if(this.formats&&this.formats.length){for(var a=[d.clone(this.formats[0])],b=1;b<this.formats.length;b++)a[a.length-1].to>this.formats[b].from||a[a.length-1].to===this.formats[b].from&&a[a.length-1].type===this.formats[b].type?a[a.length-1].to=this.formats[b].to:a.push(d.clone(this.formats[b]));this.formats=a}},g.prototype.getFormatsForRange=function(a,b){var c=[],e=this.getFormattedRanges({from:a,to:b,type:null},!1);e=d.clone(e);for(var f=0;f<e.length;f++)e[f].from<a&&e[f].to>=a&&(e[f].from=a),e[f].to>b&&e[f].from<=b&&(e[f].to=b),e[f].from<e[f].to&&c.push(e[f]);return c},g.prototype.getFormattedRanges=function(a,b){for(var c=[],d=[],e=0;e<this.formats.length;e++)this.formats[e].from>a.to||(this.formats[e].from<a.from&&this.formats[e].to>=a.to||this.formats[e].from>=a.from&&this.formats[e].to<=a.to||this.formats[e].to>a.from&&this.formats[e].to<=a.to&&this.formats[e].from<a.from||this.formats[e].from>=a.from&&this.formats[e].from<a.to&&this.formats[e].to>a.to)&&(c.push(this.formats[e]),this.formats[e].type===a.type&&d.push(this.formats[e]));return b?d.length===c.length?d:void 0:c},g.prototype.addNewFormatting=function(a){this.formats.push(a),this.formats.sort(function(a,b){var c=a.from-b.from;return c||(c=a.type>b.type?1:a.type<b.type?-1:0),c})},g.prototype.getJSONModel=function(){var a={component:g.CLASS_NAME,name:this.name,text:this.text,placeholderText:this.placeholderText,paragraphType:this.paragraphType};return this.formats&&this.formats.length&&(a.formats=this.formats),a},g.prototype.render=function(a,b){this.isRendered||(e.prototype.render.call(this,a,b),this.editMode?(this.dom.setAttribute("contenteditable",!0),this.placeholderText?this.dom.setAttribute("placeholder",this.placeholderText):this.text.length||(this.dom.innerHTML="&#8203;")):this.text.length||this.dom.classList.add(g.EMPTY_PARAGRAPH_CLASS))},g.prototype.getDeleteOps=function(a,b,c){if(!this.section)return[];var e=[{"do":{op:"deleteComponent",component:this.name,cursor:b},undo:{op:"insertComponent",componentClass:"Paragraph",section:this.section.name,component:this.name,index:this.getIndexInSection()+(a||0),attrs:{text:this.text,placeholderText:this.placeholderText,paragraphType:this.paragraphType,formats:this.formats}}}];return!c&&this.section.getLength()<2&&d.arrays.extend(e,this.section.getDeleteOps()),e},g.prototype.getInsertOps=function(a,b){return[{"do":{op:"insertComponent",componentClass:"Paragraph",section:this.section.name,cursorOffset:0,component:this.name,index:a,attrs:{text:this.text,formats:this.formats,placeholderText:this.placeholderText,paragraphType:this.paragraphType}},undo:{op:"deleteComponent",component:this.name,cursor:b}}]},g.prototype.getInsertCharsOps=function(a,b){return[{"do":{op:"insertChars",component:this.name,cursorOffset:b+a.length,value:a,index:b},undo:{op:"removeChars",component:this.name,cursorOffset:b,index:b,count:a.length}}]},g.prototype.getRemoveCharsOps=function(a,b,c){return[{"do":{op:"removeChars",component:this.name,cursorOffset:b,index:b,count:a.length},undo:{op:"insertChars",component:this.name,cursorOffset:b-(c||0),value:a,index:b}}]},g.prototype.getUpdateWordOps=function(a,b){var c=this.getWordAt_(b),e=this.getWordStart_(b),f=[];return c&&d.arrays.extend(f,this.getRemoveCharsOps(c,e)),d.arrays.extend(f,this.getInsertCharsOps(a,e)),f},g.prototype.getUpdateOps=function(a,b,c,d,e){return[{"do":{op:"updateComponent",component:this.name,cursorOffset:b,selectRange:c,formats:a.formats,value:d},undo:{op:"updateComponent",component:this.name,cursorOffset:e,selectRange:c,formats:a.formats,value:d?this.text:void 0}}]},g.prototype.getLength=function(){return this.text.length},g.prototype.getDomLength=function(){return this.dom.innerText.length},g.prototype.isBlank=function(){return!(this.placeholderText||this.text&&this.text.replace(/\s|&nbsp;|&#8203;/g,"").length)}},{"./component":2,"./loader":25,"./utils":33}],28:[function(a,b,c){"use strict";var d=a("./selection"),e=a("./utils"),f=a("./component"),g=a("./loader"),h=function(a){var b=e.extend({tagName:h.TAG_NAME,components:[],background:{}},a);f.call(this,b),this.tagName=b.tagName,this.background=b.background,this.dom=document.createElement(this.tagName),this.dom.setAttribute("name",this.name),this.components=[];for(var c=0;c<b.components.length;c++)this.insertComponentAt(b.components[c],c)};h.prototype=Object.create(f.prototype),b.exports=h,h.TAG_NAME="section",h.CLASS_NAME="Section",g.register(h.CLASS_NAME,h),h.fromJSON=function(a){for(var b=[],c=0;c<a.components.length;c++){var d=a.components[c].component,e=g.load(d);b.push(e.fromJSON(a.components[c]))}return new h({name:a.name,components:b})},h.prototype.getComponentClassName=function(){return h.CLASS_NAME},h.prototype.insertComponentAt=function(a,b){a.section=this;var c=this.components[b];return this.isRendered&&(c?a.render(this.dom,{insertBefore:c.dom,editMode:this.editMode}):a.render(this.dom,{editMode:this.editMode}),d.getInstance().setCursor({component:a,offset:0})),this.components.splice(b,0,a),a},h.prototype.removeComponent=function(a){var b=this.components.indexOf(a),c=this.components.splice(b,1)[0];try{this.dom.removeChild(c.dom)}catch(d){if("NotFoundError"!==d.name)throw d;console.warn("The browser might have already handle removing the DOM  element (e.g. When handling cut).")}return c},h.prototype.getFirstComponent=function(){return this.components[0]},h.prototype.getLastComponent=function(){return this.components[this.components.length-1]},h.prototype.getComponentsBetween=function(a,b){var c=[],d=a.parentComponent||a,e=b.parentComponent||b;if(d===e)return[];for(var f=d.getNextComponent();f&&f!==e;)c.push(f),f=f.getNextComponent();return c},h.prototype.render=function(a,b){if(this.isRendered)console.warn("Attempted to render an already rendered component.");else{f.prototype.render.call(this,a,b);for(var c=0;c<this.components.length;c++)this.components[c].render(this.dom,{editMode:this.editMode})}},h.prototype.rerender=function(){for(var a=0;a<this.components.length;a++)this.components[a].shouldRerender()&&this.components[a].rerender()},h.prototype.getJSONModel=function(){for(var a={name:this.name,component:h.CLASS_NAME,components:[]},b=0;b<this.components.length;b++)a.components.push(this.components[b].getJSONModel());return a},h.prototype.getLength=function(){for(var a=0,b=0;b<this.components.length;b++)a+=this.components[b].getLength();return a},h.onInstall=function(a){},h.prototype.getComponentByName=function(a){for(var b=0;b<this.components.length;b++)if(this.components[b].name===a)return this.components[b]}},{"./component":2,"./loader":25,"./selection":29,"./utils":33}],29:[function(a,b,c){"use strict";var d=a("./utils"),e=function(){var a="editor-selected",b=function(){this.start={component:null,offset:null},this.end={component:null,offset:null}};b.prototype=new d.CustomEventTarget,b.Events={SELECTION_CHANGED:"selection-changed"},b.prototype.reset=function(){this.start={component:null,offset:null},this.end={component:null,offset:null}},b.prototype.getComponentAtStart=function(){return this.start?this.start.component:void 0},b.prototype.getComponentAtEnd=function(){return this.end?this.end.component:void 0},b.prototype.getSelectedComponents=function(){var a=this.start.component,b=this.end.component,c=this.getSectionAtStart().getComponentsBetween(a,b),e=[a];return d.arrays.extend(e,c),a!==b&&e.push(b),e},b.prototype.getSectionAtStart=function(){return this.getComponentAtStart()?this.getComponentAtStart().section:void 0},b.prototype.getSectionAtEnd=function(){return this.getComponentAtEnd()?this.getComponentAtEnd().section:void 0},b.prototype.select=function(a,b){this.start={component:a.component,offset:a.offset},this.end={component:b.component,offset:b.offset},this.updateWindowSelectionFromModel()},b.prototype.setCursor=function(b){this.start.component&&this.start.component.dom.classList.remove(a),this.start={component:b.component,offset:b.offset},this.end={component:b.component,offset:b.offset},this.start.component&&this.start.component.dom.classList.add(a),this.updateWindowSelectionFromModel()},b.prototype.calculateOffsetFromNode=function(a,b,c){for(var e=0,f=0;f<a.childNodes.length;f++){var g=a.childNodes[f];if(g===c)break;e+=d.getTextFromElement(g).length}return e},b.prototype.updateWindowSelectionFromModel=function(){var a=document.createRange(),c=this.start.component.dom,d=this.start.offset,e=this.end.component.dom,f=this.end.offset;if(this.start.offset>0){c=this.getTextNodeAtOffset_(this.start.component.dom,d);var g=this.calculatePreviousSiblingsOffset_(this.start.component.dom,c);d=this.start.offset-g}try{a.setStart(c,d)}catch(h){h.code===h.INDEX_SIZE_ERR&&a.setStart(c,c.length)}if(e=this.end.component.dom,this.end.offset>0){e=this.getTextNodeAtOffset_(this.end.component.dom,f);var i=this.calculatePreviousSiblingsOffset_(this.end.component.dom,e);f=this.end.offset-i}try{a.setEnd(e,f)}catch(h){h.code===h.INDEX_SIZE_ERR&&a.setEnd(e,e.length)}var j=window.getSelection();j.removeAllRanges(),j.addRange(a),this.start.component.dom.scrollIntoViewIfNeeded&&this.start.component.dom.scrollIntoViewIfNeeded(!1);var k=new Event(b.Events.SELECTION_CHANGED);this.dispatchEvent(k)},b.prototype.getTextNodeAtOffset_=function(a,b){for(var c=0,e=0;e<a.childNodes.length;e++){var f=a.childNodes[e],g=d.getTextFromElement(f).length;if(c+g>=b)return"#text"!==f.nodeName&&(f=this.getTextNodeAtOffset_(f,b-c)),
f;c+=g}if(b>0)return this.getTextNodeAtOffset_(a,b-1);var h=document.createTextNode("");return a.appendChild(h),h},b.prototype.calculateStartOffsetFromWindowSelection_=function(a){var b=a.anchorNode,c=a.anchorOffset,d=b.parentNode;if(b.getAttribute&&b.getAttribute("carbon")||"#text"===b.nodeName&&d.getAttribute("carbon")&&d.childNodes.length<2)return c;var e=this.getStartComponentFromWindowSelection_(a);return c+=this.calculatePreviousSiblingsOffset_(e,b)},b.prototype.calculateEndOffsetFromWindowSelection_=function(a){var b=a.focusNode,c=a.focusOffset,d=b.parentNode;if(b.getAttribute&&b.getAttribute("carbon")||"#text"===b.nodeName&&d.getAttribute("carbon")&&d.childNodes.length<2)return c;var e=this.getEndComponentFromWindowSelection_(a);return c+=this.calculatePreviousSiblingsOffset_(e,b)},b.prototype.calculatePreviousSiblingsOffset_=function(a,b){for(var c=0,e=0;e<a.childNodes.length;e++){var f=a.childNodes[e];if(f===b)break;if("#text"!==f.nodeName){var g=(f.textContent||d.getTextFromElement(f)).length,h=this.calculatePreviousSiblingsOffset_(f,b);if(g>h){c+=h;break}}c+=d.getTextFromElement(f).length}return c},b.prototype.getStartComponentFromWindowSelection_=function(a){for(var b=a.anchorNode;b&&(!b.getAttribute||!b.getAttribute("carbon")&&b.parentNode);)b=b.parentNode;return b},b.prototype.getEndComponentFromWindowSelection_=function(a){for(var b=a.focusNode;b&&(!b.getAttribute||!b.getAttribute("carbon")&&b.parentNode);)b=b.parentNode;return b},b.prototype.updateSelectionFromWindow=function(){var c=window.getSelection();this.start.component&&this.start.component.dom.classList.remove(a);var e=this.getStartComponentFromWindowSelection_(c),f=d.getReference(e.getAttribute("name")),g=this.calculateStartOffsetFromWindowSelection_(c);f.components&&(f=f.getFirstComponent(),0===g&&f.getPreviousComponent()&&(f=f.getPreviousComponent(),g=f.getLength()));var h={component:f,offset:g},i=this.getEndComponentFromWindowSelection_(c),j=d.getReference(i.getAttribute("name")),k=this.calculateEndOffsetFromWindowSelection_(c);j.components&&(j=j.getFirstComponent(),0===k&&j.getPreviousComponent()&&(j=j.getPreviousComponent(),k=j.getLength()));var l={component:j,offset:k},m=l.component.getIndexInSection(),n=h.component.getIndexInSection(),o=l.component===h.component&&l.offset<h.offset||n>m;this.end=o?h:l,this.start=o?l:h,this.start.component===this.end.component&&this.start.component.dom.classList.add(a);var p=new Event(b.Events.SELECTION_CHANGED);this.dispatchEvent(p)},b.prototype.isCursorAtBeginning=function(){return 0===this.start.offset&&0===this.end.offset},b.prototype.isCursorAtEnding=function(){return!this.start.component.text||this.start.offset===this.start.component.getDomLength()&&this.end.offset===this.end.component.getDomLength()},b.prototype.isRange=function(){return this.start.component!=this.end.component||this.start.offset!=this.end.offset},b.prototype.initSelectionListener=function(a){a.addEventListener("mouseup",this.updateSelectionFromWindow.bind(this)),a.addEventListener("keyup",this.updateSelectionFromWindow.bind(this)),a.addEventListener("keydown",this.updateSelectionFromWindow.bind(this))};var c;return{getInstance:function(){return c||(c=new b,c.constructor=null),c},Events:b.Events}}();b.exports=e},{"./utils":33}],30:[function(a,b,c){"use strict";var d=a("../utils"),e=function(a){var b=d.extend({label:"New Button",icon:"",name:d.getUID(),fields:[],data:{}},a);d.CustomEventTarget.call(this),this.name=b.name,this.data=b.data,this.fields=[],this.dom=document.createElement(e.CONTAINER_TAG_NAME),this.dom.className=e.CONTAINER_CLASS_NAME,this.buttonDom=document.createElement(e.TAG_NAME),this.buttonDom.setAttribute("name",this.name);var c=document.createElement("i");c.className=b.icon,this.buttonDom.appendChild(c);var f=document.createElement("span");d.setTextForElement(f,b.label),this.buttonDom.appendChild(f),this.buttonDom.addEventListener("click",this.handleClick.bind(this)),this.dom.appendChild(this.buttonDom),this.fieldsDom=document.createElement(e.FIELDS_CONTAINER_TAG_NAME),this.fieldsDom.className=e.FIELDS_CONTAINER_CLASS_NAME;for(var g=0;g<b.fields.length;g++)this.addField(b.fields[g])};e.prototype=Object.create(d.CustomEventTarget.prototype),b.exports=e,e.CONTAINER_TAG_NAME="div",e.CONTAINER_CLASS_NAME="button-container",e.TAG_NAME="button",e.FIELDS_CONTAINER_TAG_NAME="div",e.FIELDS_CONTAINER_CLASS_NAME="extra-fields",e.ACTIVE_CLASS_NAME="active",e.HIDDEN_CLASS_NAME="hidden",e.prototype.handleClick=function(){var a=new CustomEvent("click",{detail:{target:this}});this.dispatchEvent(a)},e.prototype.addField=function(a){a.parentButton=this,this.fields.push(a),this.fieldsDom.appendChild(a.dom)},e.prototype.setActive=function(a){this.isActive=a,this.isActive?(this.dom.classList.add(e.ACTIVE_CLASS_NAME),this.fieldsDom.classList.add(e.ACTIVE_CLASS_NAME),this.hasExtraFields()&&this.fields[0].dom.focus()):(this.dom.classList.remove(e.ACTIVE_CLASS_NAME),this.fieldsDom.classList.remove(e.ACTIVE_CLASS_NAME))},e.prototype.setVisible=function(a){this.isVisible=a,this.isVisible?this.dom.classList.remove(e.HIDDEN_CLASS_NAME):this.dom.classList.add(e.HIDDEN_CLASS_NAME)},e.prototype.hasExtraFields=function(){return this.fields&&this.fields.length},e.prototype.getFieldByName=function(a){for(var b=0;b<this.fields.length;b++)if(this.fields[b].name===a)return this.fields[b];return null},e.prototype.resetFields=function(){for(var a=0;a<this.fields.length;a++)this.fields[a].setValue("")}},{"../utils":33}],31:[function(a,b,c){"use strict";var d=a("../utils"),e=function(a){var b=d.extend({placeholder:"New field",name:d.getUID(),required:!0,data:{},value:""},a);d.CustomEventTarget.call(this),this.name=b.name,this.data=b.data,this.placeholder=b.placeholder,this.required=b.required,this.parentButton=null,this.value=b.value,this.dom=document.createElement(e.TAG_NAME),this.dom.setAttribute("placeholder",this.placeholder),this.dom.setAttribute("name",this.name),this.dom.setAttribute("required",this.required),this.dom.addEventListener("keyup",this.handleKeyUp.bind(this))};e.prototype=Object.create(d.CustomEventTarget.prototype),b.exports=e,e.TAG_NAME="input",e.prototype.handleKeyUp=function(a){this.value=this.dom.value;var b=new CustomEvent("keyup",{detail:{target:this}});b.keyCode=a.keyCode,this.dispatchEvent(b)},e.prototype.setValue=function(a){this.value=a,this.dom.value=a}},{"../utils":33}],32:[function(a,b,c){"use strict";var d=a("../utils"),e=function(a){d.CustomEventTarget.call(this);var b=d.extend({buttons:[],classNames:[],name:d.getUID(),rtl:!1},a);this.name=b.name,this.rtl=b.rtl,this.classNames=b.classNames,this.classNames.push(e.TOOLBAR_CLASS_NAME),this.rtl&&this.classNames.push(e.RTL_CLASS_NAME),this.buttons=[],this.activeButton=null,this.isVisible=!1,this.dom=document.createElement(e.TAG_NAME),this.dom.className=this.classNames.join(" "),this.containerDom=document.createElement(e.BUTTONS_CONTAINER_TAG_NAME),this.containerDom.className=e.BUTTONS_FIELDS_CONTAINER_CLASS_NAME,this.dom.appendChild(this.containerDom),this.buttonsContainer=document.createElement(e.BUTTONS_CONTAINER_TAG_NAME),this.buttonsContainer.className=e.BUTTONS_CONTAINER_CLASS_NAME,this.containerDom.appendChild(this.buttonsContainer),this.fieldsContainer=document.createElement(e.FIELDS_CONTAINER_TAG_NAME),this.fieldsContainer.className=e.FIELDS_CONTAINER_CLASS_NAME,this.containerDom.appendChild(this.fieldsContainer);for(var c=0;c<b.buttons.length;c++)this.addButton(b.buttons[c]);document.body.appendChild(this.dom)};e.prototype=Object.create(d.CustomEventTarget.prototype),b.exports=e,e.TAG_NAME="div",e.FIELDS_CONTAINER_TAG_NAME="div",e.BUTTONS_CONTAINER_TAG_NAME="div",e.TOOLBAR_CLASS_NAME="editor-toolbar",e.RTL_CLASS_NAME="rtl",e.VISIBLE_CLASS_NAME="toolbar-visible",e.BUTTONS_CONTAINER_CLASS_NAME="editor-toolbar-buttons",e.FIELDS_CONTAINER_CLASS_NAME="extra-fields-container",e.BUTTONS_FIELDS_CONTAINER_CLASS_NAME="buttons-fields-container",e.EDGE=-999999,e.prototype.onDestroy=function(){document.body.removeChild(this.dom)},e.prototype.addButton=function(a){var b=new CustomEvent("button-added",{detail:{target:this}});this.buttons.push(a),this.buttonsContainer.appendChild(a.dom),this.fieldsContainer.appendChild(a.fieldsDom),this.dispatchEvent(b)},e.prototype.setVisible=function(a){this.isVisible=a,this.isVisible?this.dom.classList.add(e.VISIBLE_CLASS_NAME):(this.dom.classList.remove(e.VISIBLE_CLASS_NAME),this.dom.style.top=e.EDGE+"px",this.dom.style.left=e.EDGE+"px")},e.prototype.setPositionToStartTopOf=function(a){var b=window.getSelection(),c=b.getRangeAt(0),d=a.getBoundingClientRect(),e=document.createRange();try{var f=a;a.childNodes&&a.childNodes[0].length&&(f=a.childNodes[0]),e.setStart(f,0),e.setEnd(f,1),b.removeAllRanges(),b.addRange(e);var g=e.getBoundingClientRect();g.left&&g.right&&(d=g),b.removeAllRanges(),b.addRange(c)}catch(h){console.warn(h)}var i=d.top+window.pageYOffset,j=d.left;if(this.rtl){var k=this.dom.getBoundingClientRect();j=d.right-k.width}this.dom.style.top=Math.max(i,10)+"px",this.dom.style.left=Math.max(j,0)+"px"},e.prototype.setPositionToStartBottomOf=function(a){var b=a.getBoundingClientRect(),c=b.bottom+window.pageYOffset,d=b.left;if(this.rtl){var e=this.dom.getBoundingClientRect();d=b.right-e.width}this.dom.style.top=Math.max(c,0)+"px",this.dom.style.left=Math.max(d,0)+"px"},e.prototype.setPositionToTopOf=function(a){var b=a.getBoundingClientRect(),c=document.body.getBoundingClientRect(),d=this.dom.getClientRects()[0],e=d.height,f=d.width,g=(b.left+b.right)/2-f/2;g=Math.max(10,g),g=Math.min(g,c.width-f-10);var h=b.top+window.pageYOffset-e-10;this.dom.style.top=Math.max(h,10)+"px",this.dom.style.left=Math.max(g,0)+"px"},e.prototype.setPositionTopOfSelection=function(){var a=window.getSelection(),b=a.getRangeAt(0),c=b.getBoundingClientRect(),d=document.body.getBoundingClientRect(),e=this.dom.getClientRects()[0],f=e.height,g=e.width,h=(c.left+c.right)/2-g/2;h=Math.max(10,h),h=Math.min(h,d.width-g-10);var i=c.top+window.pageYOffset-f-10;this.dom.style.top=Math.max(i,10)+"px",this.dom.style.left=Math.max(h,0)+"px"},e.prototype.getButtonByName=function(a){for(var b=0;b<this.buttons.length;b++)if(this.buttons[b].name===a)return this.buttons[b];return null},e.prototype.setActiveButton=function(a){this.activeButton&&(this.activeButton.setActive(!1),this.activeButton=null),a&&(a.setActive(!0),this.activeButton=a)},e.prototype.resetFields=function(){for(var a=0;a<this.buttons.length;a++)this.buttons[a].resetFields()}},{"../utils":33}],33:[function(a,b,c){"use strict";var d={};d.arrays={},b.exports=d,d.GLOBAL_REFERENCE={},d.extend=function(a,b){var c,d={};for(c in a)d[c]=a[c];for(c in b)d[c]=b[c];return d},d.isEmpty=function(a){if(null===a||0===a.length)return!0;if(a.length>0)return!1;for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0},d.arrays.extend=function(a,b){for(var c in b)a.push(b[c]);return a},d.setReference=function(a,b){d.GLOBAL_REFERENCE[a]=b},d.getReference=function(a){return d.GLOBAL_REFERENCE[a]},d.getUID=function(a){for(var b=a||8,c=[],d="abcdefghijklmnopqrstuvwxyz0123456789",e=0;b>e;e++)c.push(d.charAt(Math.floor(Math.random()*d.length)));return c.join("")},d.debounce=function(a,b,c){var d;return function(){var e=this,f=arguments,g=c&&!d;clearTimeout(d),d=setTimeout(function(){d=null,c||a.apply(e,f)},b),g&&a.apply(e,f)}},d.willTypeCharacter=function(a){var b=[16,17,18,19,20,27,33,34,35,36,37,38,39,40,45,91,92,93,112,113,114,115,116,117,118,119,120,121,122,123,144,145];return-1===b.indexOf(a.keyCode)&&!a.ctrlKey&&!a.metaKey},d.isUndo=function(a){return!(!a.ctrlKey&&!a.metaKey||90!==a.keyCode||a.shiftKey)},d.isRedo=function(a){return!(!a.ctrlKey&&!a.metaKey||!(89===a.keyCode||a.shiftKey&&90===a.keyCode))},d.isSelectAll=function(a){return!(!a.ctrlKey&&!a.metaKey||65!==a.keyCode||a.shiftKey)},d.isMobile=function(){return!!/Mobi|iPhone|iPod|iPad|BlackBerry|Android/i.test(navigator.userAgent)},d.isFirefox=function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1},d.getTextProperty=function(a){var b;return b=a.nodeType===Node.TEXT_NODE?"data":void 0!==a.textContent?"textContent":"innerText"},d.setTextForElement=function(a,b){a[d.getTextProperty(a)]=b},d.getTextFromElement=function(a){return a[d.getTextProperty(a)]},d.clone=function(a){var b;if(null===a||"object"!=typeof a)return a;if(a instanceof Date)return b=new Date,b.setTime(a.getTime()),b;if(a instanceof Array){b=[];for(var c=0,e=a.length;e>c;c++)b[c]=d.clone(a[c]);return b}if(a instanceof Object){b={};for(var f in a)a.hasOwnProperty(f)&&(b[f]=d.clone(a[f]));return b}throw new Error("Unable to copy object! Its type is not supported.")},d.jsonp=function(a,b){var c="jsonp_callback_"+Math.round(1e5*Math.random());window[c]=function(a){delete window[c],document.body.removeChild(d),b(a)};var d=document.createElement("script");a.indexOf("?")>=0?d.src=a+"&callback="+c:d.src=a+"?callback="+c,document.body.appendChild(d)},d.ajax=function(a,b,c){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==e.readyState)if(200==e.status){var f=JSON.parse(e.responseText);b(f)}else c&&d.jsonp(a,b)},e.open("GET",a,!0),e.send()},d.listen=function(a,b,c){window.addEventListener("message",function(d){d.source==a.contentWindow&&d.data.type==b&&c(d.data)}.bind(this))},d.CustomEventTarget=function(){this._init()},d.CustomEventTarget.prototype._init=function(){this._registrations={}},d.CustomEventTarget.prototype._getListeners=function(a,b){var c=(b?"1":"0")+a;return c in this._registrations||(this._registrations[c]=[]),this._registrations[c]},d.CustomEventTarget.prototype.addEventListener=function(a,b,c){var d=this._getListeners(a,c),e=d.indexOf(b);-1===e&&d.push(b)},d.CustomEventTarget.prototype.removeEventListener=function(a,b,c){var d=this._getListeners(a,c),e=d.indexOf(b);-1!==e&&d.splice(e,1)},d.CustomEventTarget.prototype.clearEventListeners=function(){this._registrations={}},d.CustomEventTarget.prototype.dispatchEvent=function(a){for(var b=this._getListeners(a.type,!1).slice(),c=0;c<b.length;c++)b[c].call(this,a);return!a.defaultPrevented},function(){function a(a){var b=a.target||a.srcElement;b.__resizeRAF__&&h(b.__resizeRAF__),b.__resizeRAF__=g(function(){var c=b.__resizeTrigger__;c.__resizeListeners__.forEach(function(b){b.call(c,a)})})}function b(b){b.target.contentDocument.defaultView.__resizeTrigger__=b.target.__resizeElement__,b.target.contentDocument.defaultView.addEventListener("resize",a)}var c=document.attachEvent,e=navigator.userAgent.match(/Trident/),f=function(a){return window.setTimeout(a,20)},g=function(){var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||f;return function(b){return a(b)}}(),h=function(){var a=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(b){return a(b)}}();d.addResizeListener=function(d,f){if(!d.__resizeListeners__)if(d.__resizeListeners__=[],c)d.__resizeTrigger__=d,d.attachEvent("onresize",a);else{"static"==getComputedStyle(d).position&&(d.style.position="relative");var g=d.__resizeTrigger__=document.createElement("object");g.setAttribute("style","display: block; position: absolute; top: 0;left: 0; height: 100%; width: 100%; overflow: hidden;pointer-events: none; z-index: -1;"),g.__resizeElement__=d,g.onload=b,g.type="text/html",e&&d.appendChild(g),g.data="about:blank",e||d.appendChild(g)}d.__resizeListeners__.push(f)},d.removeResizeListener=function(b,d){if(b.__resizeListeners__.splice(b.__resizeListeners__.indexOf(d),1),!b.__resizeListeners__.length)if(c)b.detachEvent("onresize",a);else{var e=b.__resizeTrigger__.contentDocument;e.defaultView.removeEventListener("resize",a),b.__resizeTrigger__=!b.removeChild(b.__resizeTrigger__)}}}()},{}]},{},[26])(26)});