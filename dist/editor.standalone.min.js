/*! editor 19-09-2015 */
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.manshar=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=a("./selection"),e=a("./paragraph"),f=a("./utils"),g=function(a){var b=f.extend({sections:[]},a);this.selection=d.getInstance(),this.dom=document.createElement(g.TAG_NAME),this.sections=[];for(var c=0;c<b.sections.length;c++)this.insertSection(b.sections[c]);this.history=[],this.historyAt=0};b.exports=g,g.TAG_NAME="article",g.prototype.insertSection=function(a){return a.paragraphs&&a.paragraphs.length||a.insertParagraphAt(new e,0),this.sections.push(a),this.dom.appendChild(a.dom),a},g.prototype.removeSection=function(a){var b=this.sections.indexOf(a);return this.sections.splice(b,1),a},g.prototype.updateSection=function(a){return a},g.prototype.insertParagraph=function(a){var b=this.selection.getSectionAtEnd().insertParagraph(a);return b},g.prototype.removeParagraph=function(a){var b=this.sections.indexOf(a);return this.paragraphs.splice(b,1),a},g.prototype.updateParagraph=function(a){return a},g.prototype.getJSONModel=function(){for(var a={sections:[]},b=0;b<this.sections.length;b++)a.sections.push(this.sections[b].getJSONModel());return a},g.prototype.transaction=function(a){this.historyAt<this.history.length&&this.history.splice(this.historyAt,this.history.length-this.historyAt),this.history.push(a),this["do"]()},g.prototype["do"]=function(){for(var a=this.history[this.historyAt++],b=0;b<a.length;b++)this.exec(a[b],"do")},g.prototype.redo=function(){this.historyAt<this.history.length&&this["do"]()},g.prototype.undo=function(){if(this.historyAt>0)for(var a=this.history[--this.historyAt],b=a.length-1;b>=0;b--)this.exec(a[b],"undo")},g.prototype.exec=function(a,b){var c,d,f,g,h,i=this.selection,j=a[b].op;if("insertChars"===j)d=a[b].paragraph,f=a[b].value,g=a[b].index,c=this.getParagraphByName(d),c.insertCharactersAt(f,g),a[b].cursorOffset&&i.setCursor({paragraph:c,offset:a[b].cursorOffset});else if("removeChars"===j)d=a[b].paragraph,g=a[b].index,h=a[b].count,c=this.getParagraphByName(d),c.removeCharactersAt(g,h),a[b].cursorOffset&&i.setCursor({paragraph:c,offset:a[b].cursorOffset});else if("updateParagraph"===j)d=a[b].paragraph,f=a[b].value,c=this.getParagraphByName(d),void 0!==f&&c.setText(f),a[b].formats&&c.applyFormats(a[b].formats),void 0!==a[b].cursorOffset&&(a[b].selectRange?i.select({paragraph:c,offset:a[b].cursorOffset},{paragraph:c,offset:a[b].cursorOffset+a[b].selectRange}):i.setCursor({paragraph:c,offset:a[b].cursorOffset}));else if("deleteParagraph"===j)c=this.getParagraphByName(a[b].paragraph),c.section.removeParagraph(c);else if("insertParagraph"===j){var k=this.getSectionByName(a[b].section),l=a[b].paragraphType||e.Types.Paragraph;k.insertParagraphAt(new e({name:a[b].paragraph,paragraphType:l}),a[b].index)}},g.prototype.getSectionByName=function(a){for(var b=0;b<this.sections.length;b++)if(this.sections[b].name===a)return this.sections[b]},g.prototype.getParagraphByName=function(a){for(var b=0;b<this.sections.length;b++)for(var c=0;c<this.sections[b].paragraphs.length;c++)if(this.sections[b].paragraphs[c].name===a)return this.sections[b].paragraphs[c]}},{"./paragraph":6,"./selection":8,"./utils":9}],2:[function(a,b,c){"use strict";var d=a("./article"),e=a("./paragraph"),f=a("./section"),g=a("./utils"),h=a("./extensions/formatting"),i=a("./extensions/shortcutsManager"),j=function(a,b){var c=g.extend({extensions:[new h(this)]},b);this.name=g.getUID(),this.extensions=c.extensions,this.element=a,this.article=null,this.shortcutsManager=new i(this),this.init()};j.prototype=new g.CustomEventTarget,b.exports=j,j.prototype.init=function(){var a=new f({paragraphs:[new e({placeholderText:"Manshar Editor Demo",paragraphType:e.Types.MainHeader}),new e({placeholderText:"This is just a demo.",paragraphType:e.Types.ThirdHeader}),new e({placeholderText:"Play around and see the internal model of the article being displayed to the right. The Editor is still under development."})]});if(this.article=new d({sections:[a]}),this.article.selection.initSelectionListener(this.element),this.extensions)for(var b=0;b<this.extensions.length;b++){var c=this.extensions[b];"function"==typeof c.init&&c.init(this)}this.element.addEventListener("keydown",this.handleKeyDownEvent.bind(this)),this.element.addEventListener("paste",this.handlePaste.bind(this)),this.element.className+=" manshar-editor",this.element.setAttribute("contenteditable",!0),this.element.appendChild(this.article.dom),this.article.selection.setCursor({paragraph:a.paragraphs[0],offset:0})},j.prototype.handleKeyDownEvent=function(a){var b=this.article.selection,c=!1,d=[],e=[];if(g.isUndo(a))this.article.undo(),c=!0;else if(g.isRedo(a))this.article.redo(),c=!0;else if(b.isRange()&&g.willTypeCharacter(a)){var f=b.getSectionAtStart();e=f.getParagraphsBetween(b.start.paragraph,b.end.paragraph),d.push.apply(d,this.getDeleteSelectionOps()),this.article.transaction(d),d=[];var h=[13,8,46];c=-1!==h.indexOf(a.keyCode)}var i,j=b.getParagraphAtEnd(),k=j.section.paragraphs.indexOf(j),l=j.getNextParagraph(),m=j.getPreviousParagraph();switch(a.keyCode){case 13:var n=g.getUID();b.isCursorAtEnding()?l&&l.isPlaceholder()?b.setCursor({paragraph:l,offset:0}):d.push({"do":{op:"insertParagraph",section:b.end.paragraph.section.name,cursorOffset:0,paragraph:n,index:k-e.length+1},undo:{op:"deleteParagraph",paragraph:n}}):d.push.apply(d,this.getSplitParagraphOps(-e.length)),this.article.transaction(d),c=!0;break;case 8:b.isCursorAtBeginning()&&m&&(i=m.text.length,d.push.apply(d,this.getMergeParagraphsOps(m,j,-e.length)),this.article.transaction(d),b.setCursor({paragraph:m,offset:i}),c=!0);break;case 46:b.isCursorAtEnding()&&l&&(i=j.text.length,d.push.apply(d,this.getMergeParagraphsOps(j,l,-e.length)),this.article.transaction(d),b.setCursor({paragraph:j,offset:i}),c=!0)}if(c)a.preventDefault(),a.stopPropagation();else if(j&&g.willTypeCharacter(a)){var o=j.text,p=this.article,q=8===a.keyCode?-1:1;setTimeout(function(){var a=j.dom.innerText,c=b.end.offset+q;if(-1!==q){var e=a.charAt(Math.min(c,a.length)-1);d.push({"do":{op:"insertChars",paragraph:j.name,cursorOffset:c,value:e,index:b.end.offset},undo:{op:"removeChars",paragraph:j.name,cursorOffset:b.end.offset,index:b.end.offset,count:1}})}else if(o){var f=o.charAt(c);d.push({"do":{op:"removeChars",paragraph:j.name,cursorOffset:c,index:c,count:1},undo:{op:"insertChars",paragraph:j.name,cursorOffset:b.end.offset,value:f,index:c}})}p.transaction(d)},3)}var r=this.dispatchEvent.bind(this);setTimeout(function(){r(new Event("change"))},10)},j.prototype.getDeleteSelectionOps=function(){for(var a=[],b=this.article.selection,c=b.getSectionAtStart(),d=c.getParagraphsBetween(b.start.paragraph,b.end.paragraph),e=0;e<d.length;e++){a.push({"do":{op:"updateParagraph",paragraph:d[e].name,cursorOffset:0,value:""},undo:{op:"updateParagraph",paragraph:d[e].name,cursorOffset:d[e].text.length,value:d[e].text}});var f=c.paragraphs.indexOf(d[e]);a.push({"do":{op:"deleteParagraph",paragraph:d[e].name},undo:{op:"insertParagraph",section:d[e].section.name,paragraph:d[e].name,index:f-e}})}if(b.end.paragraph!==b.start.paragraph){var g=b.end.paragraph.text,h=g.substring(b.end.offset,g.length),i=c.paragraphs.indexOf(b.end.paragraph);a.push({"do":{op:"updateParagraph",paragraph:b.end.paragraph.name,cursorOffset:0,value:""},undo:{op:"updateParagraph",paragraph:b.end.paragraph.name,cursorOffset:b.end.offset,value:g}}),a.push({"do":{op:"deleteParagraph",paragraph:b.end.paragraph.name},undo:{op:"insertParagraph",section:b.end.paragraph.section.name,paragraph:b.end.paragraph.name,index:i-d.length}});var j=b.start.paragraph.text,k=j.substring(0,b.start.offset);a.push({"do":{op:"updateParagraph",paragraph:b.start.paragraph.name,cursorOffset:k.length,value:k+h},undo:{op:"updateParagraph",paragraph:b.start.paragraph.name,cursorOffset:b.start.offset,value:j}})}else{var l=b.start.paragraph,m=l.text.substring(b.start.offset,b.end.offset),n=b.end.offset-b.start.offset;a.push({"do":{op:"removeChars",paragraph:l.name,cursorOffset:b.start.offset,index:b.start.offset,count:n},undo:{op:"insertChars",paragraph:l.name,cursorOffset:b.start.offset,selectRange:n,index:b.start.offset,value:m}})}return a},j.prototype.getSplitParagraphOps=function(a){var b=[],c=this.article.selection,d=c.getParagraphAtEnd(),e=d.section.paragraphs.indexOf(d),f=d.text.substring(c.end.offset,d.text.length),h=d.text.substring(0,c.start.offset),i=g.getUID();return b.push({"do":{op:"insertParagraph",section:c.end.paragraph.section.name,paragraph:i,index:e+1+a},undo:{op:"deleteParagraph",paragraph:i}}),b.push({"do":{op:"updateParagraph",paragraph:d.name,cursorOffset:h.length,value:h},undo:{op:"updateParagraph",paragraph:d.name,cursorOffset:h.length,value:d.text}}),b.push({"do":{op:"updateParagraph",paragraph:i,cursorOffset:0,value:f},undo:{op:"updateParagraph",paragraph:i,cursorOffset:0,value:""}}),b},j.prototype.getMergeParagraphsOps=function(a,b,c){var d=[],e=b.section.paragraphs.indexOf(b),f=a.text.length;return d.push({"do":{op:"updateParagraph",paragraph:b.name,cursorOffset:0,value:""},undo:{op:"updateParagraph",paragraph:b.name,cursorOffset:0,value:b.text}}),d.push({"do":{op:"deleteParagraph",paragraph:b.name},undo:{op:"insertParagraph",section:b.section.name,paragraph:b.name,index:e+c}}),d.push({"do":{op:"updateParagraph",paragraph:a.name,cursorOffset:f,value:a.text+b.text},undo:{op:"updateParagraph",paragraph:a.name,cursorOffset:f,value:a.text}}),d},j.prototype.handlePaste=function(a){var b;window.clipboardData&&window.clipboardData.getData?b=window.clipboardData.getData("Text"):a.clipboardData&&a.clipboardData.getData&&(b=a.clipboardData.getData("text/html"));var c=document.createElement("div");c.innerHTML=b;var d=this.processPastedContent(c);this.article.transaction(d),a.preventDefault()},j.prototype.getJSONModel=function(){return this.article.getJSONModel()},j.prototype.processPastedContent=function(a,b){function c(a){for(var b=a.childNodes,c=0;c<b.length;c++)if(-1===u.indexOf(b[c].nodeName))return!1;return!0}function d(a){var b;return b=a.nodeType===Node.TEXT_NODE?"data":t?"textContent":"innerText"}function f(a){for(var b=0,c=0;c<a.length;c++)a[c]&&"meta"===a[c].nodeName.toLowerCase()&&b++;return a.length-b<2?!0:void 0}var h,i,j,k,l=[],m=a.innerText,n=a.childNodes,o=this.article.selection,p=o.start.paragraph,q=o.getSectionAtStart(),r=q.paragraphs.indexOf(p),s=b||r,t=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,u="B BR BIG I SMALL ABBR ACRONYM CITE EM STRONG A BDO"+" SPAN SUB SUP #text".split(" ");if(n&&n.length&&!f(n)){o.isCursorAtEnding()||l.push.apply(l,this.getSplitParagraphOps(s)),s++;for(var v=0;v<n.length;v++){var w=n[v],x=w.nodeName&&w.nodeName.toLowerCase();switch(x){case void 0:case"meta":case"script":case"style":case"embed":case"br":case"hr":case"img":case"figure":continue;case"ul":case"ol":case"p":case"#text":j=e.Types.Paragraph;break;case"blockquote":j=e.Types.Quote;break;case"h1":j=e.Types.MainHeader;break;case"h2":j=e.Types.SecondaryHeader;break;case"h3":case"h4":case"h5":case"h6":j=e.Types.ThirdHeader;break;case"pre":j=e.Types.Code;break;default:c(n[v])?j=e.Types.Paragraph:(k=this.processPastedContent(n[v],s),s+=k.length/2)}k?Array.prototype.push.apply(l,k):(i=g.getUID(),h=w[d(w)],l.push({"do":{op:"insertParagraph",section:q.name,paragraph:i,index:s++,paragraphType:j},undo:{op:"deleteParagraph",paragraph:i}}),l.push({"do":{op:"updateParagraph",paragraph:i,cursorOffset:h.length,value:h},undo:{op:"updateParagraph",paragraph:i,cursorOffset:0,value:""}}))}}else{var y=p.text.substring(0,o.start.offset),z=(y+m).length,A=y.length;l.push({"do":{op:"insertChars",paragraph:p.name,cursorOffset:z,value:m,index:A},undo:{op:"removeChars",paragraph:p.name,cursorOffset:A,index:A,count:m.length}})}return l}},{"./article":1,"./extensions/formatting":3,"./extensions/shortcutsManager":4,"./paragraph":6,"./section":7,"./utils":9}],3:[function(a,b,c){"use strict";var d=a("../paragraph"),e=a("../selection"),f=a("../utils"),g=function(a){var b=f.extend({enableInline:!0,enableBlock:!0},a);this.enableInline=b.enableInline,this.enableBlock=b.enableBlock,this.editor=null};b.exports=g,g.ACTIVE_ACTION_CLASS="active",g.Types={BLOCK:"block",INLINE:"inline"},g.EDGE=-999999,g.Actions={Block:[{label:"h1",value:d.Types.MainHeader,shortcuts:["alt+cmd+1","alt+ctrl+1"]},{label:"h2",value:d.Types.SecondaryHeader,shortcuts:["alt+cmd+2","alt+ctrl+2"]},{label:"h3",value:d.Types.ThirdHeader,shortcuts:["alt+cmd+3","alt+ctrl+3"]},{label:"â€",value:d.Types.Quote,shortcuts:["alt+cmd+4","alt+ctrl+4"]},{label:"{}",value:d.Types.Code,shortcuts:["alt+cmd+5","alt+ctrl+5"]}],Inline:[{label:"B",value:"strong",shortcuts:["ctrl+b","cmd+b"]},{label:"I",value:"em",shortcuts:["ctrl+i","cmd+i"]},{label:"U",value:"u",shortcuts:["ctrl+u","cmd+u"]},{label:"S",value:"s",shortcuts:["ctrl+s","cmd+s"]},{label:"a",value:"a",shortcuts:["ctrl+k","cmd+k"]}]},g.prototype.init=function(a){this.editor=a,this.inlineToolbar=this.createInlineToolbar(),document.body.appendChild(this.inlineToolbar),this.blockToolbar=this.createBlockToolbar(),document.body.appendChild(this.blockToolbar),this.editor.article.selection.addEventListener(e.Events.SELECTION_CHANGED,this.handleSelectionChangedEvent.bind(this))},g.prototype.createInlineToolbar=function(){var a=document.createElement("div");return a.id="editor-inline-toolbar-"+this.editor.name,a.className="editor-toolbar editor-inline-toolbar",a.appendChild(this.createToolbarButtons(g.Actions.Inline,g.Types.INLINE)),a},g.prototype.createBlockToolbar=function(){var a=document.createElement("div");return a.id="editor-block-toolbar-"+this.editor.name,a.className="editor-toolbar editor-block-toolbar",a.appendChild(this.createToolbarButtons(g.Actions.Block,g.Types.BLOCK)),a},g.prototype.createToolbarButtons=function(a,b){var c=document.createElement("ul");c.className="editor-toolbar-buttons";for(var d=0;d<a.length;d++)c.appendChild(this.createButton(a[d],b));return c},g.prototype.createButton=function(a,b){var c=document.createElement("button");c.innerHTML=a.label,c.value=a.value,c.type=b,c.addEventListener("click",this.handleButtonClicked.bind(this));for(var d=0;d<a.shortcuts.length;d++)this.editor.shortcutsManager.register(a.shortcuts[d],this.handleKeyboardShortcut.bind(this));return c},g.prototype.handleButtonClicked=function(a){a.target.getAttribute("type")==g.Types.BLOCK?(this.handleBlockFormatterClicked(a),this.reloadBlockToolbarStatus()):(this.handleInlineFormatterClicked(a),this.reloadInlineToolbarStatus())},g.prototype.handleSelectionChangedEvent=function(){var a=window.getSelection();a.isCollapsed?this.repositionBlockToolbar():this.repositionInlineToolbar()},g.prototype.repositionInlineToolbar=function(){var a=window.getSelection(),b=a.getRangeAt(0),c=b.getBoundingClientRect();this.setToolbarPosition(this.blockToolbar,g.EDGE,g.EDGE);var d=this.inlineToolbar.getClientRects()[0].width,e=(c.left+c.right)/2-d/2,f=c.top+window.pageYOffset;this.setToolbarPosition(this.inlineToolbar,f,e),this.reloadInlineToolbarStatus()},g.prototype.repositionBlockToolbar=function(){var a=this.editor.article.selection,b=a.getParagraphAtStart(),c=b.dom.getBoundingClientRect();this.setToolbarPosition(this.inlineToolbar,g.EDGE,g.EDGE);var d=c.top+window.pageYOffset;this.setToolbarPosition(this.blockToolbar,d,c.left),this.reloadBlockToolbarStatus(this.blockToolbar)},g.prototype.reloadBlockToolbarStatus=function(){var a=this.editor.article.selection,b=a.getParagraphAtStart(),c=b.paragraphType;this.setToolbarActiveAction(this.blockToolbar,c)},g.prototype.reloadInlineToolbarStatus=function(){var a=this.editor.article.selection,b=a.getParagraphAtStart(),c=b.getSelectedFormatter(a);c=c?c.type:null,this.setToolbarActiveAction(this.inlineToolbar,c)},g.prototype.setToolbarActiveAction=function(a,b){var c=a.querySelector("button.active");if(c&&(c.className=""),b){var d=a.querySelector("[value="+b+"]");d&&(d.className=g.ACTIVE_ACTION_CLASS)}},g.prototype.setToolbarPosition=function(a,b,c){a.style.top=b+"px",a.style.left=c+"px"},g.prototype.handleBlockFormatterClicked=function(a){var b=a.target.getAttribute("value");this.handleBlockFormatting(b),a.preventDefault(),a.stopPropagation()},g.prototype.handleBlockFormatting=function(a){for(var b=this.editor.article.selection,c=b.getSelectedParagraphs(),e=[],f=0;f<c.length;f++){var g=a;c[f].paragraphType===a&&(g=d.Types.Paragraph);var h=c[f].section.paragraphs.indexOf(c[f])+f;e.push({"do":{op:"updateParagraph",paragraph:c[f].name,value:"",cursorOffset:0},undo:{op:"updateParagraph",paragraph:c[f].name,value:c[f].text,cursorOffset:b.end.offset}}),e.push({"do":{op:"deleteParagraph",paragraph:c[f].name},undo:{op:"insertParagraph",section:c[f].section.name,index:h,paragraph:c[f].name,paragraphType:c[f].paragraphType}}),e.push({"do":{op:"insertParagraph",section:c[f].section.name,paragraph:c[f].name,index:h,paragraphType:g},undo:{op:"deleteParagraph",paragraph:c[f].name}}),e.push({"do":{op:"updateParagraph",paragraph:c[f].name,value:c[f].text,cursorOffset:b.end.offset},undo:{op:"updateParagraph",paragraph:c[f].name,value:"",cursorOffset:0}})}this.editor.article.transaction(e),this.editor.dispatchEvent(new Event("change"))},g.prototype.format=function(a,b,c){var d,e,g,h=[],i={op:"updateParagraph",paragraph:a.name,cursorOffset:b.start.offset,selectRange:b.end.offset-b.start.offset,formats:[]},j=a.getFormattedRanges(c,!0);if(j&&j.length)for(var k=0;k<j.length;k++){var l=j[k];c.to===l.to&&c.from===l.from?(d=f.clone(i),d.formats.push(l),g={"do":d,undo:d},h.push(g)):c.to===l.to?(d=f.clone(i),d.formats.push(c),g={"do":d,undo:d},h.push(g)):c.from===l.from?(d=f.clone(i),d.formats.push(c),g={"do":d,undo:d},h.push(g)):c.to<l.to&&c.from>l.from?(d=f.clone(i),d.formats.push(l),d.formats.push({type:l.type,from:l.from,to:c.from}),d.formats.push({type:l.type,from:c.to,to:l.to}),e=f.clone(d),e.formats.reverse(),g={"do":d,undo:e},h.push(g)):(d=f.clone(i),d.formats.push(l),d.formats.push({type:l.type,from:Math.min(l.from,c.from),to:Math.max(l.to,c.to)}),e=f.clone(d),e.formats.reverse(),g={"do":d,undo:e},h.push(g))}else{for(var m=a.getFormattedRanges(c,!1),n=f.clone(m),o=0;o<n.length;o++)n[o].from<c.from&&n[o].to>c.from&&(n[o].from=c.from),n[o].to>c.to&&n[o].from<c.to&&(n[o].to=c.to);d=f.clone(i),Array.prototype.push.apply(d.formats,n),d.formats.push(c),e=f.clone(d),e.formats.reverse(),g={"do":d,undo:e},h.push(g)}return h},g.prototype.handleInlineFormatterClicked=function(a){var b=a.target.getAttribute("value");this.handleInlineFormatting(b),a.preventDefault(),a.stopPropagation()},g.prototype.handleInlineFormatting=function(a){var b=this.editor.article.selection,c=b.getParagraphAtStart(),d={type:a,from:b.start.offset,to:b.end.offset};if(b.end.offset-b.start.offset!==0){var e=this.format(c,b,d);this.editor.article.transaction(e),this.editor.dispatchEvent(new Event("change"))}},g.prototype.handleKeyboardShortcut=function(a){var b=this.editor.shortcutsManager.getShortcutId(a),c=this.getInlineFormatterForShortcut(b);if(c)return this.handleInlineFormatting(c.value),!1;var d=this.getBlockFormatterForShortcut(b);return d?(this.handleBlockFormatting(d.value),!1):!0},g.prototype.getInlineFormatterForShortcut=function(a){for(var b=g.Actions.Inline,c=0;c<b.length;c++)if(-1!==b[c].shortcuts.indexOf(a))return b[c];return null},g.prototype.getBlockFormatterForShortcut=function(a){for(var b=g.Actions.Block,c=0;c<b.length;c++)if(-1!==b[c].shortcuts.indexOf(a))return b[c];return null}},{"../paragraph":6,"../selection":8,"../utils":9}],4:[function(a,b,c){"use strict";var d=function(a){this.editor=a,this.registery={},this.editor.element.addEventListener("keydown",this.handleKeyDownEvent.bind(this))};b.exports=d,d.META_KEYS=[16,17,91],d.prototype.getShortcutId=function(a){var b=[],c=a.keyCode||a.which;return-1!==d.META_KEYS.indexOf(c)?!1:(a.metaKey&&b.push("cmd"),a.ctrlKey&&b.push("ctrl"),a.shiftKey&&b.push("shift"),a.altKey&&b.push("alt"),b.sort(),c&&b.push(String.fromCharCode(c)),b.join("+").toLowerCase())},d.prototype.isShortcutEvent=function(a){var b=a.keyCode||a.which;return(a.metaKey||a.ctrlKey)&&b&&-1===d.META_KEYS.indexOf(b)},d.prototype.handleKeyDownEvent=function(a){if(this.isShortcutEvent(a)){var b=this.getShortcutId(a);if(this.registery[b]){var c=this.registery[b](a);if(c===!1)return a.preventDefault(),a.stopPropagation(),!1}}return!0},d.prototype.register=function(a,b,c){if(this.registery[a]&&!c)throw'"'+a+'" shortcut has already been registered.';this.registery[a]=b}},{}],5:[function(a,b,c){"use strict";b.exports.Editor=a("./editor"),b.exports.Article=a("./article"),b.exports.Paragraph=a("./paragraph"),b.exports.Section=a("./section"),b.exports.Selection=a("./selection"),b.exports.Formatting=a("./extensions/formatting")},{"./article":1,"./editor":2,"./extensions/formatting":3,"./paragraph":6,"./section":7,"./selection":8}],6:[function(a,b,c){"use strict";var d=a("./utils"),e=function(a){var b=d.extend({text:"",placeholderText:null,paragraphType:e.Types.Paragraph,name:d.getUID()},a);this.name=b.name,d.setReference(this.name,this),this.text=b.text,this.placeholderText=b.placeholderText,this.formats=[],this.metadata={},this.layout={},this.section=null,this.paragraphType=b.paragraphType,this.dom=document.createElement(this.paragraphType),this.dom.setAttribute("name",this.name),this.placeholderText?this.dom.setAttribute("placeholder",this.placeholderText):this.text.length||(this.dom.innerHTML="&#8203;"),this.setText(b.text)};b.exports=e,e.Types={Paragraph:"p",MainHeader:"h1",SecondaryHeader:"h2",ThirdHeader:"h3",Quote:"blockquote",Code:"pre"},e.prototype.setText=function(a){this.text=a||"",this.text.length||this.placeholderText?this.dom.innerText=this.text:this.dom.innerHTML="&#8203;"},e.prototype.insertCharactersAt=function(a,b){var c=[this.text.substring(0,b),this.text.substring(b)],d=c.join(a);this.shiftFormatsFrom_(b,a.length),this.setText(d),this.updateInnerDom_()},e.prototype.removeCharactersAt=function(a,b){var c=[this.text.substring(0,a),this.text.substring(a+b)],d=c.join("");this.shiftFormatsFrom_(a,-1*b),this.setText(d),this.updateInnerDom_()},e.prototype.shiftFormatsFrom_=function(a,b){for(var c=0;c<this.formats.length;c++)this.formats[c].from>=a&&(this.formats[c].from+=b),this.formats[c].to>=a&&(this.formats[c].to+=b)},e.prototype.updateInnerDom_=function(){if(!this.formats.length)return void this.setText(this.text);for(var a,b=document.createElement(this.paragraphType),c=0,d=0,e=0;e<this.formats.length;e++){c=this.formats[e].from,c-d>0&&(a=this.text.substring(d,c),b.appendChild(document.createTextNode(a))),d=this.formats[e].to;var f=document.createElement(this.formats[e].type);f.innerText=this.text.substring(c,d),b.appendChild(f)}var g=this.text.length;g-d>0&&(a=this.text.substring(g,d),b.appendChild(document.createTextNode(a))),this.dom.innerHTML=b.innerHTML},e.prototype.isPlaceholder=function(){return!!this.placeholderText&&!this.text.length},e.prototype.getNextParagraph=function(){if(this.section){var a=this.section.paragraphs.indexOf(this);return this.section.paragraphs[a+1]}},e.prototype.getPreviousParagraph=function(){if(this.section){var a=this.section.paragraphs.indexOf(this);return this.section.paragraphs[a-1]}},e.prototype.applyFormats=function(a){for(var b=0;b<a.length;b++)this.format(a[b])},e.prototype.getSelectedFormatter=function(a){for(var b=0;b<this.formats.length;b++)if(a.start.offset>=this.formats[b].from&&a.start.offset<this.formats[b].to&&a.end.offset>this.formats[b].from&&a.end.offset<=this.formats[b].to)return this.formats[b];return null},e.prototype.format=function(a,b){a=d.clone(a);var c=this.getFormattedRanges(a,!b);if(c&&c.length)for(var e=d.clone(c),f=0;f<e.length;f++){var g=e[f],h=this.formats.indexOf(c[f]);a.to===g.to&&a.from===g.from?this.formats.splice(h,1):a.to===g.to||a.to>g.to&&a.from<g.to&&b?(g.to=a.from,this.formats[h]=g):a.from===g.from||a.from<g.from&&a.to>g.from&&b?(g.from=a.to,this.formats[h]=g):a.to<g.to&&a.from>g.from?(this.formats.splice(h,1),this.addNewFormatting({type:g.type,from:g.from,to:a.from}),this.addNewFormatting({type:g.type,from:a.to,to:g.to})):b?this.formats.splice(h,1):(g.from=Math.min(g.from,a.from),g.to=Math.max(g.to,a.to),this.formats[h]=g)}else{var i=this.getFormattedRanges(a,!1);i&&i.length?b||(this.format(a,!0),this.format(a)):this.addNewFormatting(a)}b||this.normalizeFormats_(),this.updateInnerDom_()},e.prototype.normalizeFormats_=function(){if(this.formats&&this.formats.length){for(var a=[d.clone(this.formats[0])],b=1;b<this.formats.length;b++)a[a.length-1].to>this.formats[b].from||a[a.length-1].to===this.formats[b].from&&a[a.length-1].type===this.formats[b].type?a[a.length-1].to=this.formats[b].to:a.push(d.clone(this.formats[b]));this.formats=a}},e.prototype.getFormattedRanges=function(a,b){for(var c=[],d=[],e=0;e<this.formats.length;e++)this.formats[e].from>a.to||(this.formats[e].from<a.from&&this.formats[e].to>=a.to||this.formats[e].from>=a.from&&this.formats[e].to<=a.to||this.formats[e].to>a.from&&this.formats[e].to<=a.to&&this.formats[e].from<a.from||this.formats[e].from>=a.from&&this.formats[e].from<a.to&&this.formats[e].to>a.to)&&(c.push(this.formats[e]),this.formats[e].type===a.type&&d.push(this.formats[e]));return b?d.length===c.length?d:void 0:c},e.prototype.addNewFormatting=function(a){this.formats.push(a),this.formats.sort(function(a,b){var c=a.from-b.from;return c||(c=a.type>b.type?1:a.type<b.type?-1:0),c})},e.prototype.getJSONModel=function(){var a={name:this.name,text:this.text,paragraphType:this.paragraphType};return this.formats&&(a.formats=this.formats),a}},{"./utils":9}],7:[function(a,b,c){"use strict";var d=a("./selection"),e=a("./utils"),f=function(a){var b=e.extend({paragraphs:[],background:{},name:e.getUID()},a);this.name=b.name,e.setReference(this.name,this),this.background=b.background,this.dom=document.createElement(f.TAG_NAME),this.dom.setAttribute("name",this.name),this.paragraphs=[];for(var c=0;c<b.paragraphs.length;c++)this.insertParagraphAt(b.paragraphs[c],c)};b.exports=f,f.TAG_NAME="section",f.prototype.insertParagraphAt=function(a,b){a.section=this;var c=this.paragraphs[b];return c?this.dom.insertBefore(a.dom,c.dom):this.dom.appendChild(a.dom),this.paragraphs.splice(b,0,a),d.getInstance().setCursor({paragraph:a,offset:0}),a},f.prototype.removeParagraph=function(a){var b=this.paragraphs.indexOf(a),c=this.paragraphs.splice(b,1)[0];return this.dom.removeChild(c.dom),c},f.prototype.getParagraphsBetween=function(a,b){for(var c=[],d=this.paragraphs.indexOf(a)+1,e=this.paragraphs.indexOf(b),f=d;e>f;f++)c.push(this.paragraphs[f]);return c},f.prototype.getJSONModel=function(){for(var a={paragraphs:[]},b=0;b<this.paragraphs.length;b++)a.paragraphs.push(this.paragraphs[b].getJSONModel());return a}},{"./selection":8,"./utils":9}],8:[function(a,b,c){"use strict";var d=a("./utils"),e=function(){var a=function(){this.start={paragraph:null,offset:null},this.end={paragraph:null,offset:null}};a.prototype=new d.CustomEventTarget,a.Events={SELECTION_CHANGED:"selectionchanged"},a.prototype.reset=function(){this.start={paragraph:null,offset:null},this.end={paragraph:null,offset:null}},a.prototype.getParagraphAtStart=function(){return this.start?this.start.paragraph:void 0},a.prototype.getParagraphAtEnd=function(){return this.end?this.end.paragraph:void 0},a.prototype.getSelectedParagraphs=function(){var a=this.start.paragraph,b=this.end.paragraph,c=this.getSectionAtStart().getParagraphsBetween(a,b),d=[a];return Array.prototype.push.apply(d,c),a!==b&&d.push(b),d},a.prototype.getSectionAtStart=function(){return this.getParagraphAtStart()?this.getParagraphAtStart().section:void 0},a.prototype.getSectionAtEnd=function(){return this.getParagraphAtEnd()?this.getParagraphAtEnd().section:void 0},a.prototype.select=function(a,b){this.start={paragraph:a.paragraph,offset:a.offset},this.end={paragraph:b.paragraph,offset:b.offset},this.updateWindowSelectionFromModel()},a.prototype.setCursor=function(a){this.start={paragraph:a.paragraph,offset:a.offset},this.end={paragraph:a.paragraph,offset:a.offset},this.updateWindowSelectionFromModel()},a.prototype.calculateOffsetFromNode=function(a,b,c){for(var d=0,e=0;e<a.childNodes.length;e++){var f=a.childNodes[e];if(f===c)break;d+=(f.textContent||f.innerText).length}return d},a.prototype.updateWindowSelectionFromModel=function(){var a=document.createRange(),b=this.start.paragraph.dom,c=this.start.offset,d=this.end.paragraph.dom,e=this.end.offset;if(this.start.offset>0){b=this.getTextNodeAtOffset_(this.start.paragraph.dom,c),b||(b=this.getTextNodeAtOffset_(this.start.paragraph.dom,c-1));var f=this.calculatePreviousSiblingsOffset_(this.start.paragraph.dom,b);c=this.start.offset-f}try{a.setStart(b,c)}catch(g){a.setStart(b,c-1)}if(d=this.end.paragraph.dom,this.end.offset>0){d=this.getTextNodeAtOffset_(this.end.paragraph.dom,e),d||(d=this.getTextNodeAtOffset_(this.end.paragraph.dom,e-1));var h=this.calculatePreviousSiblingsOffset_(this.end.paragraph.dom,d);e=this.end.offset-h}try{a.setEnd(d,e)}catch(g){a.setEnd(d,e-1)}var i=window.getSelection();i.removeAllRanges(),i.addRange(a)},a.prototype.getTextNodeAtOffset_=function(a,b){for(var c=0,d=0;d<a.childNodes.length;d++){var e=a.childNodes[d],f=(e.textContent||e.innerText).length;if(c+f>=b)return"#text"!==e.nodeName&&(e=this.getTextNodeAtOffset_(e,b-c)),e;c+=f}return null},a.prototype.calculateStartOffsetFromWindowSelection_=function(a){var b=a.anchorNode,c=a.anchorOffset;if(b.getAttribute&&b.getAttribute("name"))return c;var d=this.getStartParagraphFromWindowSelection_(a);return c+=this.calculatePreviousSiblingsOffset_(d,b)},a.prototype.calculateEndOffsetFromWindowSelection_=function(a){var b=a.focusNode,c=a.focusOffset;if(b.getAttribute&&b.getAttribute("name"))return c;var d=this.getStartParagraphFromWindowSelection_(a);return c+=this.calculatePreviousSiblingsOffset_(d,b)},a.prototype.calculatePreviousSiblingsOffset_=function(a,b){for(var c=0,d=0;d<a.childNodes.length;d++){var e=a.childNodes[d];if(e===b)break;if("#text"!==e.nodeName){var f=(e.textContent||e.innerText).length,g=this.calculatePreviousSiblingsOffset_(e,b);if(f>g){c+=g;break}}c+=(e.textContent||e.innerText).length}return c},a.prototype.getStartParagraphFromWindowSelection_=function(a){for(var b=a.anchorNode;!b.getAttribute||!b.getAttribute("name")&&b.parentNode;)b=b.parentNode;return b},a.prototype.getEndParagraphFromWindowSelection_=function(a){for(var b=a.focusNode;!b.getAttribute||!b.getAttribute("name")&&b.parentNode;)b=b.parentNode;return b},a.prototype.updateSelectionFromWindow=function(){var b=window.getSelection(),c=this.getStartParagraphFromWindowSelection_(b),e={paragraph:d.getReference(c.getAttribute("name")),offset:this.calculateStartOffsetFromWindowSelection_(b)},f=this.getEndParagraphFromWindowSelection_(b),g={paragraph:d.getReference(f.getAttribute("name")),offset:this.calculateEndOffsetFromWindowSelection_(b)},h=g.paragraph.section.paragraphs.indexOf(g.paragraph),i=e.paragraph.section.paragraphs.indexOf(e.paragraph),j=g.paragraph===e.paragraph&&g.offset<e.offset||i>h;this.end=j?e:g,this.start=j?g:e;var k=new Event(a.Events.SELECTION_CHANGED);this.dispatchEvent(k)},a.prototype.isCursorAtBeginning=function(){return 0===this.start.offset&&0===this.end.offset},a.prototype.isCursorAtEnding=function(){return this.start.offset===this.start.paragraph.text.length&&this.end.offset===this.end.paragraph.text.length},a.prototype.isRange=function(){
return this.start.paragraph!=this.end.paragraph||this.start.offset!=this.end.offset},a.prototype.initSelectionListener=function(a){a.addEventListener("mouseup",this.updateSelectionFromWindow.bind(this)),a.addEventListener("keyup",this.updateSelectionFromWindow.bind(this))};var b;return{getInstance:function(){return b||(b=new a,b.constructor=null),b},Events:a.Events}}();b.exports=e},{"./utils":9}],9:[function(a,b,c){"use strict";var d={};b.exports=d,d.GLOBAL_REFERENCE={},d.extend=function(a,b){var c,d={};for(c in a)d[c]=a[c];for(c in b)d[c]=b[c];return d},d.setReference=function(a,b){d.GLOBAL_REFERENCE[a]=b},d.getReference=function(a){return d.GLOBAL_REFERENCE[a]},d.getUID=function(a){for(var b=a||4,c=[],d="abcdefghijklmnopqrstuvwxyz0123456789",e=0;b>e;e++)c.push(d.charAt(Math.floor(Math.random()*d.length)));return c.join("")},d.willTypeCharacter=function(a){var b=[16,17,18,19,20,27,33,34,35,36,37,38,39,40,45,91,92,93,112,113,114,115,116,117,118,119,120,121,122,123,144,145];return-1===b.indexOf(a.keyCode)&&!a.ctrlKey&&!a.metaKey},d.isUndo=function(a){return!(!a.ctrlKey&&!a.metaKey||90!==a.keyCode||a.shiftKey)},d.isRedo=function(a){return!(!a.ctrlKey&&!a.metaKey||!(89===a.keyCode||a.shiftKey&&90===a.keyCode))},d.clone=function(a){var b;if(null===a||"object"!=typeof a)return a;if(a instanceof Date)return b=new Date,b.setTime(a.getTime()),b;if(a instanceof Array){b=[];for(var c=0,e=a.length;e>c;c++)b[c]=d.clone(a[c]);return b}if(a instanceof Object){b={};for(var f in a)a.hasOwnProperty(f)&&(b[f]=d.clone(a[f]));return b}throw new Error("Unable to copy object! Its type is not supported.")},d.CustomEventTarget=function(){this._init()},d.CustomEventTarget.prototype._init=function(){this._registrations={}},d.CustomEventTarget.prototype._getListeners=function(a,b){var c=(b?"1":"0")+a;return c in this._registrations||(this._registrations[c]=[]),this._registrations[c]},d.CustomEventTarget.prototype.addEventListener=function(a,b,c){var d=this._getListeners(a,c),e=d.indexOf(b);-1===e&&d.push(b)},d.CustomEventTarget.prototype.removeEventListener=function(a,b,c){var d=this._getListeners(a,c),e=d.indexOf(b);-1!==e&&d.splice(e,1)},d.CustomEventTarget.prototype.dispatchEvent=function(a){for(var b=this._getListeners(a.type,!1).slice(),c=0;c<b.length;c++)b[c].call(this,a);return!a.defaultPrevented}},{}]},{},[5])(5)});